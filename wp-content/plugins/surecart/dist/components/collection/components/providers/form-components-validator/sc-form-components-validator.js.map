{"version":3,"file":"sc-form-components-validator.js","sourceRoot":"","sources":["../../../../src/components/providers/form-components-validator/sc-form-components-validator.tsx"],"names":[],"mappings":"AAAA,OAAO,EAAE,SAAS,EAAE,OAAO,EAAE,CAAC,EAAE,IAAI,EAAE,KAAK,EAAE,KAAK,EAAE,MAAM,eAAe,CAAC;AAC1E,OAAO,EAAE,EAAE,EAAE,MAAM,iBAAiB,CAAC;AACrC,OAAO,EAAE,KAAK,IAAI,aAAa,EAAE,QAAQ,IAAI,gBAAgB,EAAE,MAAM,iBAAiB,CAAC;AAEvF,OAAO,EAAE,uBAAuB,EAAE,MAAM,yBAAyB,CAAC;AAMlE,MAAM,OAAO,yBAAyB;;;;;;;;;;;;EAiCpC,iBAAiB;;IACf,2DAA2D;IAC3D,IAAI,IAAI,CAAC,QAAQ;MAAE,OAAO;IAE1B,wDAAwD;IACxD,IAAI,uBAAuB,EAAE,EAAE;MAC7B,IAAI,CAAC,eAAe,EAAE,CAAC;KACxB;IAED,mBAAmB;IACnB,IAAI,MAAA,MAAA,MAAA,aAAa,CAAC,QAAQ,0CAAE,iBAAiB,0CAAE,IAAI,0CAAE,MAAM,EAAE;MAC3D,IAAI,CAAC,QAAQ,EAAE,CAAC;KACjB;IACD,IAAI,CAAC,CAAC,CAAA,MAAA,aAAa,CAAC,QAAQ,0CAAE,UAAU,CAAA,EAAE;MACxC,IAAI,CAAC,UAAU,EAAE,CAAC;KACnB;IAED,wBAAwB;IACxB,IAAI,CAAA,MAAA,aAAa,CAAC,QAAQ,0CAAE,gBAAgB,MAAI,MAAA,aAAa,CAAC,QAAQ,0CAAE,iCAAiC,CAAA,EAAE;MACzG,IAAI,CAAC,kBAAkB,EAAE,CAAC;KAC3B;IAED,IAAI,CAAC,CAAC,CAAA,MAAA,aAAa,CAAC,QAAQ,0CAAE,eAAe,CAAA,EAAE;MAC7C,IAAI,CAAC,iBAAiB,EAAE,CAAC;KAC1B;EACH,CAAC;EAGD,sBAAsB;IACpB,IAAI,CAAC,IAAI,CAAC,UAAU;MAAE,OAAO;IAC7B,IAAI,CAAC,6BAA6B,EAAE,CAAC;EACvC,CAAC;EAED,iBAAiB;;IACf,IAAI,CAAC,UAAU,GAAG,CAAC,CAAC,IAAI,CAAC,EAAE,CAAC,aAAa,CAAC,2BAA2B,CAAC,CAAC;IACvE,IAAI,CAAC,aAAa,GAAG,CAAC,CAAC,IAAI,CAAC,EAAE,CAAC,aAAa,CAAC,uBAAuB,CAAC,CAAC;IACtE,IAAI,CAAC,aAAa,GAAG,CAAC,CAAC,IAAI,CAAC,EAAE,CAAC,aAAa,CAAC,gBAAgB,CAAC,CAAC;IAC/D,IAAI,CAAC,UAAU,GAAG,CAAC,CAAC,IAAI,CAAC,EAAE,CAAC,aAAa,CAAC,kBAAkB,CAAC,CAAC;IAC9D,IAAI,CAAC,kBAAkB,GAAG,CAAC,CAAC,IAAI,CAAC,EAAE,CAAC,aAAa,CAAC,qBAAqB,CAAC,CAAC;IACzE,IAAI,CAAC,iBAAiB,GAAG,CAAC,CAAC,IAAI,CAAC,EAAE,CAAC,aAAa,CAAC,uBAAuB,CAAC,CAAC;IAE1E,qDAAqD;IACrD,IAAI,MAAA,IAAI,CAAC,WAAW,0CAAE,WAAW,EAAE;MACjC,IAAI,CAAC,eAAe,EAAE,CAAC;MAEvB,+CAA+C;MAC/C,IAAI,MAAA,IAAI,CAAC,WAAW,0CAAE,eAAe,EAAE;QACrC,IAAI,CAAC,aAAa,EAAE,CAAC;OACtB;KACF;IAED,IAAI,CAAC,iBAAiB,EAAE,CAAC;IACzB,IAAI,CAAC,sBAAsB,GAAG,gBAAgB,CAAC,UAAU,EAAE,GAAG,EAAE,CAAC,IAAI,CAAC,iBAAiB,EAAE,CAAC,CAAC;IAC3F,IAAI,CAAC,qCAAqC,GAAG,gBAAgB,CAAC,+BAA+B,EAAE,GAAG,EAAE,CAAC,IAAI,CAAC,iBAAiB,EAAE,CAAC,CAAC;EACjI,CAAC;EAED,oBAAoB;IAClB,IAAI,CAAC,sBAAsB,EAAE,CAAC;IAC9B,IAAI,CAAC,qCAAqC,EAAE,CAAC;EAC/C,CAAC;EAED,6BAA6B;;IAC3B,IAAI,CAAC,CAAA,MAAA,aAAa,CAAC,QAAQ,0CAAE,yBAAyB,CAAA;MAAE,OAAO;IAE/D,kBAAkB;IAClB,MAAM,OAAO,GAAG,IAAI,CAAC,EAAE,CAAC,aAAa,CAAC,2BAA2B,CAAC,CAAC;IACnE,IAAI,CAAC,OAAO;MAAE,OAAO;IAErB,uBAAuB;IACvB,OAAO,CAAC,QAAQ,GAAG,IAAI,CAAC;IAExB,kDAAkD;IAClD,MAAM,YAAY,GAAG,IAAI,CAAC,EAAE,CAAC,aAAa,CAAC,kBAAkB,CAAC,CAAC;IAC/D,IAAI,CAAC,CAAC,YAAY,EAAE;MAClB,YAAY,CAAC,QAAQ,GAAG,IAAI,CAAC;MAC7B,OAAO;KACR;IAED,4CAA4C;IAC5C,OAAO,CAAC,WAAW,GAAG,IAAI,CAAC;IAC3B,OAAO,CAAC,QAAQ,GAAG,IAAI,CAAC;EAC1B,CAAC;EAED,eAAe;IACb,IAAI,IAAI,CAAC,UAAU,EAAE;MACnB,OAAO;KACR;IAED,MAAM,OAAO,GAAG,IAAI,CAAC,EAAE,CAAC,aAAa,CAAC,YAAY,CAAC,CAAC;IACpD,MAAM,eAAe,GAAG,QAAQ,CAAC,aAAa,CAAC,2BAA2B,CAAC,CAAC;IAC5E,eAAe,CAAC,KAAK,GAAG,EAAE,CAAC,kBAAkB,EAAE,UAAU,CAAC,CAAC;IAC3D,MAAM,cAAc,GAAG,QAAQ,CAAC,aAAa,CAAC,0BAA0B,CAAC,CAAC;IAC1E,cAAc,CAAC,KAAK,GAAG,EAAE,CAAC,iBAAiB,EAAE,UAAU,CAAC,CAAC;IACzD,OAAO,CAAC,UAAU,CAAC,YAAY,CAAC,eAAe,EAAE,OAAO,CAAC,CAAC;IAC1D,OAAO,CAAC,UAAU,CAAC,YAAY,CAAC,cAAc,EAAE,OAAO,CAAC,CAAC;IACzD,IAAI,CAAC,UAAU,GAAG,IAAI,CAAC;EACzB,CAAC;EAED,aAAa;IACX,IAAI,IAAI,CAAC,aAAa;MAAE,OAAO;IAC/B,MAAM,OAAO,GAAG,IAAI,CAAC,EAAE,CAAC,aAAa,CAAC,YAAY,CAAC,CAAC;IACpD,MAAM,QAAQ,GAAG,QAAQ,CAAC,aAAa,CAAC,uBAAuB,CAAC,CAAC;IACjE,OAAO,CAAC,UAAU,CAAC,YAAY,CAAC,QAAQ,EAAE,OAAO,CAAC,CAAC;IACnD,IAAI,CAAC,aAAa,GAAG,IAAI,CAAC;EAC5B,CAAC;EAED,QAAQ;IACN,IAAI,IAAI,CAAC,aAAa;MAAE,OAAO;IAC/B,MAAM,sBAAsB,GAAG,IAAI,CAAC,EAAE,CAAC,aAAa,CAAC,0BAA0B,CAAC,IAAI,IAAI,CAAC,EAAE,CAAC,aAAa,CAAC,YAAY,CAAC,CAAC;IACxH,MAAM,KAAK,GAAG,QAAQ,CAAC,aAAa,CAAC,gBAAgB,CAAC,CAAC;IACvD,sBAAsB,aAAtB,sBAAsB,uBAAtB,sBAAsB,CAAE,UAAU,CAAC,YAAY,CAAC,KAAK,EAAE,sBAAsB,CAAC,WAAW,CAAC,CAAC;IAC3F,IAAI,CAAC,aAAa,GAAG,IAAI,CAAC;EAC5B,CAAC;EAED,UAAU;;IACR,IAAI,IAAI,CAAC,UAAU;MAAE,OAAO;IAC5B,MAAM,KAAK,GAAG,IAAI,CAAC,EAAE,CAAC,aAAa,CAAC,iCAAiC,CAAC,CAAC;IACvE,MAAM,GAAG,GAAG,QAAQ,CAAC,aAAa,CAAC,kBAAkB,CAAC,CAAC;IAEvD,IAAI,CAAC,KAAK;MAAE,OAAO;IAEnB,IAAI,CAAA,MAAA,KAAK,aAAL,KAAK,uBAAL,KAAK,CAAE,sBAAsB,0CAAE,OAAO,MAAK,YAAY,EAAE;MAC3D,KAAK,CAAC,UAAU,CAAC,YAAY,CAAC,GAAG,EAAE,KAAK,CAAC,sBAAsB,CAAC,CAAC;KAClE;SAAM;MACL,KAAK,CAAC,UAAU,CAAC,YAAY,CAAC,GAAG,EAAE,KAAK,CAAC,CAAC;KAC3C;IACD,IAAI,CAAC,UAAU,GAAG,IAAI,CAAC;EACzB,CAAC;EAED,kBAAkB;IAChB,IAAI,IAAI,CAAC,kBAAkB;MAAE,OAAO;IAEpC,MAAM,OAAO,GAAG,IAAI,CAAC,EAAE,CAAC,aAAa,CAAC,YAAY,CAAC,CAAC;IACpD,MAAM,eAAe,GAAG,QAAQ,CAAC,aAAa,CAAC,qBAAqB,CAAC,CAAC;IACtE,OAAO,CAAC,UAAU,CAAC,YAAY,CAAC,eAAe,EAAE,OAAO,CAAC,CAAC;IAC1D,IAAI,CAAC,kBAAkB,GAAG,IAAI,CAAC;EACjC,CAAC;EAED,iBAAiB;;IACf,IAAI,IAAI,CAAC,iBAAiB;MAAE,OAAO;IAEnC,IAAI,mBAAmB,GAAY,IAAI,CAAC,EAAE,CAAC,aAAa,CAAC,kBAAkB,CAAC,CAAC;IAC7E,MAAM,KAAK,GAAG,IAAI,CAAC,EAAE,CAAC,aAAa,CAAC,iCAAiC,CAAC,CAAC;IAEvE,IAAI,CAAC,KAAK;MAAE,OAAO;IAEnB,IAAI,CAAC,mBAAmB,EAAE;MACxB,mBAAmB,GAAG,CAAA,MAAA,KAAK,aAAL,KAAK,uBAAL,KAAK,CAAE,sBAAsB,0CAAE,OAAO,MAAK,YAAY,CAAC,CAAC,CAAC,KAAK,CAAC,sBAAsB,CAAC,CAAC,CAAC,KAAK,CAAC;KACtH;IAED,MAAM,cAAc,GAAG,QAAQ,CAAC,aAAa,CAAC,uBAAuB,CAAC,CAAC;IACvE,mBAAmB,CAAC,UAAU,CAAC,YAAY,CAAC,cAAc,EAAE,mBAAmB,CAAC,CAAC;IACjF,IAAI,CAAC,iBAAiB,GAAG,IAAI,CAAC;EAChC,CAAC;EAED,MAAM;IACJ,OAAO,eAAQ,CAAC;EAClB,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;CACF","sourcesContent":["import { Component, Element, h, Prop, State, Watch } from '@stencil/core';\nimport { __ } from '@wordpress/i18n';\nimport { state as checkoutState, onChange as onCheckoutChange } from '@store/checkout';\nimport { TaxProtocol } from '../../../types';\nimport { shippingAddressRequired } from '@store/checkout/getters';\n\n@Component({\n  tag: 'sc-form-components-validator',\n  shadow: true,\n})\nexport class ScFormComponentsValidator {\n  @Element() el: HTMLScFormComponentsValidatorElement;\n\n  private removeCheckoutListener: () => void;\n  private removePaymentRequiresShippingListener: () => void;\n\n  /** Disable validation? */\n  @Prop() disabled: boolean;\n\n  /** The tax protocol */\n  @Prop() taxProtocol: TaxProtocol;\n\n  /** Is there an address field? */\n  @State() hasAddress: boolean;\n\n  /** Is there a tax id field? */\n  @State() hasTaxIDField: boolean;\n\n  /** Is there a bumps field? */\n  @State() hasBumpsField: boolean;\n\n  /** Is there a tax line? */\n  @State() hasTaxLine: boolean;\n\n  /** Is there a bump line? */\n  @State() hasBumpLine: boolean;\n\n  /** Is there shipping choices */\n  @State() hasShippingChoices: boolean;\n\n  /** Is there a shipping amount */\n  @State() hasShippingAmount: boolean;\n\n  handleOrderChange() {\n    // bail if we don't have address invalid error or disabled.\n    if (this.disabled) return;\n\n    // make sure to add the address field if it's not there.\n    if (shippingAddressRequired()) {\n      this.addAddressField();\n    }\n\n    // add order bumps.\n    if (checkoutState.checkout?.recommended_bumps?.data?.length) {\n      this.addBumps();\n    }\n    if (!!checkoutState.checkout?.tax_amount) {\n      this.addTaxLine();\n    }\n\n    // add shipping choices.\n    if (checkoutState.checkout?.shipping_enabled && checkoutState.checkout?.selected_shipping_choice_required) {\n      this.addShippingChoices();\n    }\n\n    if (!!checkoutState.checkout?.shipping_amount) {\n      this.addShippingAmount();\n    }\n  }\n\n  @Watch('hasAddress')\n  handleHasAddressChange() {\n    if (!this.hasAddress) return;\n    this.handleShippingAddressRequired();\n  }\n\n  componentWillLoad() {\n    this.hasAddress = !!this.el.querySelector('sc-order-shipping-address');\n    this.hasTaxIDField = !!this.el.querySelector('sc-order-tax-id-input');\n    this.hasBumpsField = !!this.el.querySelector('sc-order-bumps');\n    this.hasTaxLine = !!this.el.querySelector('sc-line-item-tax');\n    this.hasShippingChoices = !!this.el.querySelector('sc-shipping-choices');\n    this.hasShippingAmount = !!this.el.querySelector('sc-line-item-shipping');\n\n    // automatically add address field if tax is enabled.\n    if (this.taxProtocol?.tax_enabled) {\n      this.addAddressField();\n\n      // if eu vat is required, add the tax id field.\n      if (this.taxProtocol?.eu_vat_required) {\n        this.addTaxIDField();\n      }\n    }\n\n    this.handleOrderChange();\n    this.removeCheckoutListener = onCheckoutChange('checkout', () => this.handleOrderChange());\n    this.removePaymentRequiresShippingListener = onCheckoutChange('paymentMethodRequiresShipping', () => this.handleOrderChange());\n  }\n\n  disconnectedCallback() {\n    this.removeCheckoutListener();\n    this.removePaymentRequiresShippingListener();\n  }\n\n  handleShippingAddressRequired() {\n    if (!checkoutState.checkout?.shipping_address_required) return;\n\n    // get the address\n    const address = this.el.querySelector('sc-order-shipping-address');\n    if (!address) return;\n\n    // require the address.\n    address.required = true;\n\n    // if we have a customer name field, require that.\n    const customerName = this.el.querySelector('sc-customer-name');\n    if (!!customerName) {\n      customerName.required = true;\n      return;\n    }\n\n    // require the name and show the name input.\n    address.requireName = true;\n    address.showName = true;\n  }\n\n  addAddressField() {\n    if (this.hasAddress) {\n      return;\n    }\n\n    const payment = this.el.querySelector('sc-payment');\n    const shippingAddress = document.createElement('sc-order-shipping-address');\n    shippingAddress.label = __('Shipping Address', 'surecart');\n    const billingAddress = document.createElement('sc-order-billing-address');\n    billingAddress.label = __('Billing Address', 'surecart');\n    payment.parentNode.insertBefore(shippingAddress, payment);\n    payment.parentNode.insertBefore(billingAddress, payment);\n    this.hasAddress = true;\n  }\n\n  addTaxIDField() {\n    if (this.hasTaxIDField) return;\n    const payment = this.el.querySelector('sc-payment');\n    const taxInput = document.createElement('sc-order-tax-id-input');\n    payment.parentNode.insertBefore(taxInput, payment);\n    this.hasTaxIDField = true;\n  }\n\n  addBumps() {\n    if (this.hasBumpsField) return;\n    const attachReferenceElement = this.el.querySelector('sc-order-billing-address') || this.el.querySelector('sc-payment');\n    const bumps = document.createElement('sc-order-bumps');\n    attachReferenceElement?.parentNode.insertBefore(bumps, attachReferenceElement.nextSibling);\n    this.hasBumpsField = true;\n  }\n\n  addTaxLine() {\n    if (this.hasTaxLine) return;\n    const total = this.el.querySelector('sc-line-item-total[total=total]');\n    const tax = document.createElement('sc-line-item-tax');\n\n    if (!total) return;\n\n    if (total?.previousElementSibling?.tagName === 'SC-DIVIDER') {\n      total.parentNode.insertBefore(tax, total.previousElementSibling);\n    } else {\n      total.parentNode.insertBefore(tax, total);\n    }\n    this.hasTaxLine = true;\n  }\n\n  addShippingChoices() {\n    if (this.hasShippingChoices) return;\n\n    const payment = this.el.querySelector('sc-payment');\n    const shippingChoices = document.createElement('sc-shipping-choices');\n    payment.parentNode.insertBefore(shippingChoices, payment);\n    this.hasShippingChoices = true;\n  }\n\n  addShippingAmount() {\n    if (this.hasShippingAmount) return;\n\n    let insertBeforeElement: Element = this.el.querySelector('sc-line-item-tax');\n    const total = this.el.querySelector('sc-line-item-total[total=total]');\n\n    if (!total) return;\n\n    if (!insertBeforeElement) {\n      insertBeforeElement = total?.previousElementSibling?.tagName === 'SC-DIVIDER' ? total.previousElementSibling : total;\n    }\n\n    const shippingAmount = document.createElement('sc-line-item-shipping');\n    insertBeforeElement.parentNode.insertBefore(shippingAmount, insertBeforeElement);\n    this.hasShippingAmount = true;\n  }\n\n  render() {\n    return <slot />;\n  }\n}\n"]}