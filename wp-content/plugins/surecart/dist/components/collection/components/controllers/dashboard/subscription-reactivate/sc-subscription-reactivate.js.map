{"version":3,"file":"sc-subscription-reactivate.js","sourceRoot":"","sources":["../../../../../src/components/controllers/dashboard/subscription-reactivate/sc-subscription-reactivate.tsx"],"names":[],"mappings":"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","sourcesContent":["import { Component, Event, EventEmitter, Fragment, Prop, State, Watch, h } from '@stencil/core';\nimport { __ } from '@wordpress/i18n';\nimport { Checkout, Period, Subscription } from 'src/types';\nimport apiFetch from '../../../../functions/fetch';\nimport { addQueryArgs } from '@wordpress/url';\n\n@Component({\n  tag: 'sc-subscription-reactivate',\n  shadow: true,\n})\nexport class ScSubscriptionReactivate {\n  /** Whether it is open */\n  @Prop() open: boolean;\n\n  /** The subscription to reactivate */\n  @Prop() subscription: Subscription;\n\n  /** Reactivate modal closed */\n  @Event({ cancelable: true }) scRequestClose: EventEmitter<'close-button' | 'keyboard' | 'overlay'>;\n\n  /** Refresh subscriptions */\n  @Event() scRefresh: EventEmitter<void>;\n\n  @State() busy: boolean;\n  @State() error: string;\n  @State() upcomingPeriod: Period;\n  @State() loading: boolean = false;\n\n  @Watch('open')\n  openChanged() {\n    if (this.open) {\n      this.fetchUpcoming();\n    }\n  }\n\n  async fetchUpcoming() {\n    this.loading = true;\n    try {\n      this.upcomingPeriod = await apiFetch({\n        method: 'PATCH',\n        path: addQueryArgs(`surecart/v1/subscriptions/${this.subscription?.id}/upcoming_period`, {\n          skip_product_group_validation: true,\n          expand: ['period.checkout'],\n        }),\n        data: {\n          purge_pending_update: false,\n        },\n      });\n    } catch (e) {\n      this.error = e?.message || __('Something went wrong', 'surecart');\n    } finally {\n      this.loading = false;\n    }\n  }\n\n  async reactivateSubscription() {\n    try {\n      this.error = '';\n      this.busy = true;\n      await apiFetch({\n        path: `surecart/v1/subscriptions/${this.subscription?.id}/restore`,\n        method: 'PATCH',\n      });\n      this.scRefresh.emit();\n      this.scRequestClose.emit('close-button');\n    } catch (e) {\n      this.error = e?.message || __('Something went wrong', 'surecart');\n    } finally {\n      this.busy = false;\n    }\n  }\n\n  renderLoading() {\n    return (\n      <sc-flex flexDirection=\"column\" style={{ gap: '1em' }}>\n        <sc-skeleton style={{ width: '20%', display: 'inline-block' }}></sc-skeleton>\n        <sc-skeleton style={{ width: '60%', display: 'inline-block' }}></sc-skeleton>\n        <sc-skeleton style={{ width: '40%', display: 'inline-block' }}></sc-skeleton>\n      </sc-flex>\n    );\n  }\n\n  render() {\n    return (\n      <sc-dialog noHeader open={this.open} style={{ '--width': '600px', '--body-spacing': 'var(--sc-spacing-xxx-large)' }}>\n        <sc-dashboard-module\n          loading={this.loading}\n          heading={__('Resubscribe', 'surecart')}\n          class=\"subscription-reactivate\"\n          error={this.error}\n          style={{ '--sc-dashboard-module-spacing': '1em' }}\n        >\n          {this.loading ? (\n            this.renderLoading()\n          ) : (\n            <Fragment>\n              <div slot=\"description\">\n                <sc-alert open type=\"warning\" title={__('Confirm Charge', 'surecart')}>\n                  {__('You will be charged', 'surecart')}{' '}\n                  <sc-format-number type=\"currency\" value={(this.upcomingPeriod?.checkout as Checkout)?.amount_due} currency={this.subscription?.currency}></sc-format-number>{' '}\n                  {__('immediately for your subscription.', 'surecart')}\n                </sc-alert>\n                <sc-text\n                  style={{\n                    '--font-size': 'var(--sc-font-size-medium)',\n                    '--color': 'var(--sc-input-label-color)',\n                    '--line-height': 'var(--sc-line-height-dense)',\n                    'margin-top': 'var(--sc-spacing-medium)',\n                  }}\n                >\n                  {__('Your subscription will be reactivated and will renew automatically on', 'surecart')}{' '}\n                  <strong>\n                    <sc-format-date type=\"timestamp\" date={this.upcomingPeriod?.end_at} month=\"long\" day=\"numeric\" year=\"numeric\"></sc-format-date>\n                  </strong>\n                </sc-text>\n              </div>\n              <sc-flex justifyContent=\"flex-start\">\n                <sc-button type=\"primary\" loading={this.busy} disabled={this.busy} onClick={() => this.reactivateSubscription()}>\n                  {__('Yes, Reactivate', 'surecart')}\n                </sc-button>\n                <sc-button disabled={this.busy} style={{ color: 'var(--sc-color-gray-500)' }} type=\"text\" onClick={() => this.scRequestClose.emit()}>\n                  {__('No, Keep Inactive', 'surecart')}\n                </sc-button>\n              </sc-flex>\n            </Fragment>\n          )}\n          {this.busy && <sc-block-ui></sc-block-ui>}\n        </sc-dashboard-module>\n      </sc-dialog>\n    );\n  }\n}\n"]}