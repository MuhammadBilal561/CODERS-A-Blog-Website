{"version":3,"file":"sc-product-price-modal.js","sourceRoot":"","sources":["../../../../../src/components/controllers/product/sc-product-price-modal/sc-product-price-modal.tsx"],"names":[],"mappings":"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","sourcesContent":["import { Component, Element, h, Prop, State } from '@stencil/core';\nimport { onChange, state } from '@store/product';\nimport { __ } from '@wordpress/i18n';\n\nimport { getProductBuyLink, submitCartForm } from '@store/product/mutations';\nimport { setProduct } from '@store/product/setters';\nimport { getAdditionalErrorMessages, getTopLevelError } from '../../../../functions/error';\nimport { ScNoticeStore } from '../../../../types';\n@Component({\n  tag: 'sc-product-price-modal',\n  styleUrl: 'sc-product-price-modal.scss',\n  shadow: true,\n})\nexport class ScProductPriceModal {\n  @Element() el: HTMLScProductBuyButtonElement;\n\n  private priceInput: HTMLScPriceInputElement;\n\n  /** The button text */\n  @Prop() buttonText: string;\n\n  /** Whether to add to cart */\n  @Prop() addToCart: boolean;\n\n  /** The product id */\n  @Prop() productId: string;\n\n  // Is add to cart enabled.\n  @State() error: ScNoticeStore;\n\n  async submit() {\n    // if add to cart is undefined/false navigate to buy url\n    if (!this.addToCart) {\n      const checkoutUrl = window?.scData?.pages?.checkout;\n      if (!checkoutUrl) return;\n      return window.location.assign(getProductBuyLink(this.productId, checkoutUrl));\n    }\n\n    // submit the cart form.\n    try {\n      await submitCartForm(this.productId);\n    } catch (e) {\n      console.error(e);\n      this.error = e;\n    }\n  }\n\n  componentWillLoad() {\n    // focus on price input when opened.\n    onChange(this.productId, () => {\n      setTimeout(() => {\n        this.priceInput?.triggerFocus();\n      }, 50);\n    });\n  }\n\n  render() {\n    if (!state[this.productId]?.selectedPrice?.ad_hoc) {\n      return null;\n    }\n\n    return (\n      <sc-dialog open={state[this.productId]?.dialog === (this?.addToCart ? 'ad_hoc_cart' : 'ad_hoc_buy')} onScRequestClose={() => setProduct(this.productId, { dialog: null })}>\n        <span class=\"dialog__header\" slot=\"label\">\n          {!!state[this.productId]?.product?.image_url && (\n            <div class=\"dialog__image\">\n              <img src={state[this.productId]?.product?.image_url} />\n            </div>\n          )}\n          <div class=\"dialog__header-text\">\n            <div class=\"dialog__action\">{__('Enter An Amount', 'surecart')}</div>\n            <div class=\"dialog__product-name\">{state[this.productId]?.product?.name}</div>\n          </div>\n        </span>\n\n        <sc-form\n          onScSubmit={e => {\n            e.stopImmediatePropagation();\n            this.submit();\n          }}\n          onScFormSubmit={e => e.stopImmediatePropagation()}\n        >\n          {!!this.error && (\n            <sc-alert type=\"danger\" scrollOnOpen={true} open={!!this.error} closable={false}>\n              {!!getTopLevelError(this.error) && <span slot=\"title\" innerHTML={getTopLevelError(this.error)}></span>}\n              {(getAdditionalErrorMessages(this.error) || []).map((message, index) => (\n                <div innerHTML={message} key={index}></div>\n              ))}\n            </sc-alert>\n          )}\n          <sc-price-input\n            ref={el => (this.priceInput = el as HTMLScPriceInputElement)}\n            value={state[this.productId]?.adHocAmount?.toString?.()}\n            currency-code={state[this.productId]?.selectedPrice?.currency}\n            min={state[this.productId]?.selectedPrice?.ad_hoc_min_amount}\n            max={state[this.productId]?.selectedPrice?.ad_hoc_max_amount}\n            onScInput={e => setProduct(this.productId, { adHocAmount: parseInt(e.target.value) })}\n            required\n          />\n          <sc-button type=\"primary\" full submit busy={state[this.productId]?.busy}>\n            <slot>{this.buttonText || __('Add To Cart', 'surecart')}</slot>\n          </sc-button>\n        </sc-form>\n      </sc-dialog>\n    );\n  }\n}\n"]}