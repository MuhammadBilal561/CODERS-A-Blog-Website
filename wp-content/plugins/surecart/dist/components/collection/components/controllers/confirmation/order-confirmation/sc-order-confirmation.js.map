{"version":3,"file":"sc-order-confirmation.js","sourceRoot":"","sources":["../../../../../src/components/controllers/confirmation/order-confirmation/sc-order-confirmation.tsx"],"names":[],"mappings":"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","sourcesContent":["import apiFetch from '../../../../functions/fetch';\nimport { Checkout, ManualPaymentMethod } from '../../../../types';\nimport { Component, State, h, Prop } from '@stencil/core';\nimport { __ } from '@wordpress/i18n';\nimport { addQueryArgs, getQueryArg } from '@wordpress/url';\nimport { Universe } from 'stencil-wormhole';\n\n@Component({\n  tag: 'sc-order-confirmation',\n  styleUrl: 'sc-order-confirmation.css',\n  shadow: true,\n})\nexport class ScOrderConfirmation {\n  @Prop({ mutable: true }) order: Checkout;\n\n  /** Loading */\n  @State() loading: boolean = false;\n\n  /** Error */\n  @State() error: string;\n\n  componentWillLoad() {\n    // @ts-ignore\n    Universe.create(this, this.state());\n    // get teh session\n    this.getSession();\n  }\n\n  /** Get session id from url. */\n  getSessionId() {\n    if (this.order?.id) return this.order.id;\n    return getQueryArg(window.location.href, 'sc_order');\n  }\n\n  /** Update a session */\n  async getSession() {\n    if (!this.getSessionId()) return;\n    if (this.order?.id) return;\n    try {\n      this.loading = true;\n      this.order = (await await apiFetch({\n        path: addQueryArgs(`surecart/v1/checkouts/${this.getSessionId()}`, {\n          expand: [\n            'line_items',\n            'line_item.price',\n            'line_item.fees',\n            'price.product',\n            'customer',\n            'customer.shipping_address',\n            'payment_intent',\n            'discount',\n            'manual_payment_method',\n            'discount.promotion',\n            'billing_address',\n            'shipping_address',\n          ],\n          refresh_status: true,\n        }),\n      })) as Checkout;\n    } catch (e) {\n      if (e?.message) {\n        this.error = e.message;\n      } else {\n        this.error = __('Something went wrong', 'surecart');\n      }\n    } finally {\n      this.loading = false;\n    }\n  }\n\n  state() {\n    const manualPaymentMethod = this.order?.manual_payment_method as ManualPaymentMethod;\n    return {\n      processor: 'stripe',\n      loading: this.loading,\n      orderId: this.getSessionId(),\n      order: this.order,\n      customer: this.order?.customer,\n      manualPaymentTitle: manualPaymentMethod?.name,\n      manualPaymentInstructions: manualPaymentMethod?.instructions,\n    };\n  }\n\n  renderOnHold() {\n    if (this.order?.status !== 'processing') return null;\n    if (this?.order?.payment_intent?.processor_type === 'paypal') {\n      return (\n        <sc-alert type=\"warning\" open={true}>\n          {__('Paypal is taking a closer look at this payment. Itâ€™s required for some payments and normally takes up to 3 business days.', 'surecart')}\n        </sc-alert>\n      );\n    }\n  }\n\n  renderManualInstructions() {\n    const paymentMethod = this.order?.manual_payment_method as ManualPaymentMethod;\n    if (!paymentMethod?.instructions) return;\n    return (\n      <sc-alert type=\"info\" open>\n        <span slot=\"title\">{paymentMethod?.name}</span>\n        <div innerHTML={paymentMethod?.instructions}></div>\n      </sc-alert>\n    );\n  }\n\n  render() {\n    return (\n      <Universe.Provider state={this.state()}>\n        <div class={{ 'order-confirmation': true }}>\n          <div\n            class={{\n              'order-confirmation__content': true,\n              'hidden': !this.order?.id && !this.loading,\n            }}\n          >\n            <sc-order-confirm-components-validator checkout={this.order}>\n              <slot />\n            </sc-order-confirm-components-validator>\n          </div>\n\n          {!this.order?.id && !this.loading && (\n            <sc-heading>\n              {__('Order not found.', 'surecart')}\n              <span slot=\"description\">{__('This order could not be found. Please try again.', 'surecart')}</span>\n            </sc-heading>\n          )}\n        </div>\n      </Universe.Provider>\n    );\n  }\n}\n"]}