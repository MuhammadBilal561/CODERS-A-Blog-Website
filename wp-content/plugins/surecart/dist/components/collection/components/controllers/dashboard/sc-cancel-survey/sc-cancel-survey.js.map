{"version":3,"file":"sc-cancel-survey.js","sourceRoot":"","sources":["../../../../../src/components/controllers/dashboard/sc-cancel-survey/sc-cancel-survey.tsx"],"names":[],"mappings":"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","sourcesContent":["import { Component, Event, EventEmitter, h, Prop, State, Watch } from '@stencil/core';\nimport { __ } from '@wordpress/i18n';\nimport apiFetch from '../../../../functions/fetch';\nimport { CancellationReason, ResponseError, SubscriptionProtocol } from '../../../../types';\n\n@Component({\n  tag: 'sc-cancel-survey',\n  styleUrl: 'sc-cancel-survey.scss',\n  shadow: true,\n})\nexport class ScCancelSurvey {\n  private textArea: HTMLScTextareaElement;\n  @Prop() protocol: SubscriptionProtocol;\n  @Prop({ mutable: true }) reasons: CancellationReason[];\n  @State() loading: boolean;\n  @State() selectedReason: CancellationReason;\n  @State() comment: string;\n  @State() error: ResponseError;\n  @Event() scAbandon: EventEmitter<void>;\n  @Event() scSubmitReason: EventEmitter<{ reason: CancellationReason; comment: string }>;\n\n  componentWillLoad() {\n    if (!this.reasons) {\n      this.fetchReasons();\n    }\n  }\n\n  @Watch('selectedReason')\n  handleSelectedReasonChange() {\n    if (this.selectedReason?.comment_enabled) {\n      setTimeout(() => {\n        this.textArea.triggerFocus();\n      }, 50);\n    }\n  }\n\n  async fetchReasons() {\n    try {\n      this.loading = true;\n      this.reasons = await apiFetch({\n        path: 'surecart/v1/cancellation_reasons',\n      });\n    } catch (e) {\n      console.error(e);\n      this.error = e;\n    } finally {\n      this.loading = false;\n    }\n  }\n\n  async handleSubmit(e) {\n    e.preventDefault();\n    e.stopImmediatePropagation();\n    try {\n      this.scSubmitReason.emit({ reason: this.selectedReason, comment: this.comment });\n    } catch (e) {\n      console.error(e);\n      this.error = e;\n    }\n  }\n\n  renderReasons() {\n    if (this.loading) {\n      return (\n        <sc-choice>\n          <sc-skeleton></sc-skeleton>\n        </sc-choice>\n      );\n    }\n\n    return (this.reasons || []).map(reason => (\n      <sc-choice\n        value={reason?.id}\n        name=\"reason\"\n        onScChange={e => {\n          if (e.target.checked) {\n            this.selectedReason = reason;\n          }\n        }}\n      >\n        {reason?.label}\n      </sc-choice>\n    ));\n  }\n\n  render() {\n    const { reasons_title, reasons_description, skip_link } = this.protocol?.preservation_locales || {};\n\n    if (this.loading) {\n      return <sc-skeleton></sc-skeleton>;\n    }\n\n    return (\n      <div class=\"cancel-survey\">\n        <sc-dashboard-module heading={reasons_title} style={{ '--sc-dashboard-module-spacing': '2em' }}>\n          <span slot=\"description\">{reasons_description}</span>\n          <sc-form onScSubmit={e => this.handleSubmit(e)} style={{ '--sc-form-row-spacing': '2em' }}>\n            <sc-choices showLabel={false} label={__('Choose a reason', 'surecart')} style={{ '--columns': '2' }} required>\n              {this.renderReasons()}\n            </sc-choices>\n            {this.selectedReason?.comment_enabled && (\n              <sc-textarea\n                label={this.selectedReason?.comment_prompt || __('Additional Comments', 'surecart')}\n                required\n                ref={el => (this.textArea = el as HTMLScTextareaElement)}\n                onScInput={e => (this.comment = e.target.value)}\n              ></sc-textarea>\n            )}\n            <sc-flex justifyContent=\"flex-start\">\n              <sc-button type=\"primary\" submit>\n                {__('Continue', 'surecart')}\n                <sc-icon name=\"arrow-right\" slot=\"suffix\" />\n              </sc-button>\n              {!!skip_link && (\n                <sc-button class=\"cancel-survey__abort-link\" type=\"text\" onClick={() => this.scAbandon.emit()}>\n                  {skip_link}\n                </sc-button>\n              )}\n            </sc-flex>\n          </sc-form>\n        </sc-dashboard-module>\n      </div>\n    );\n  }\n}\n"]}