{"version":3,"file":"sc-product-selected-price.js","sourceRoot":"","sources":["../../../../../src/components/controllers/checkout-form/sc-product-selected-price/sc-product-selected-price.tsx"],"names":[],"mappings":"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","sourcesContent":["import { Component, Host, h, Prop, Fragment, State, Event, EventEmitter, Watch } from '@stencil/core';\nimport { __ } from '@wordpress/i18n';\nimport { intervalString } from '../../../../functions/price';\nimport { LineItemData } from 'src/types';\nimport { getLineItemByProductId } from '@store/checkout/getters';\nimport { formBusy } from '@store/form/getters';\nimport { onChange } from '@store/checkout';\n\n@Component({\n  tag: 'sc-product-selected-price',\n  styleUrl: 'sc-product-selected-price.scss',\n  shadow: true,\n})\nexport class ScProductSelectedPrice {\n  /** The input reference */\n  private input: HTMLScPriceInputElement;\n\n  /** The product id. */\n  @Prop() productId: string;\n\n  /** Show the input? */\n  @State() showInput: boolean;\n\n  /** The adHocAmount */\n  @State() adHocAmount: number;\n\n  /** Toggle line item event */\n  @Event() scUpdateLineItem: EventEmitter<LineItemData>;\n\n  /** The line item from state. */\n  lineItem() {\n    return getLineItemByProductId(this.productId);\n  }\n\n  componentWillLoad() {\n    onChange('checkout', () => {\n      this.adHocAmount = this.lineItem()?.ad_hoc_amount || this.lineItem()?.price?.amount;\n    });\n  }\n\n  updatePrice() {\n    this.showInput = false;\n    if (!this.adHocAmount && this.adHocAmount !== 0) return;\n    if (this.adHocAmount === this.lineItem()?.ad_hoc_amount) return;\n    this.scUpdateLineItem.emit({ price_id: this.lineItem()?.price?.id, quantity: 1, ad_hoc_amount: this.adHocAmount });\n  }\n\n  @Watch('showInput')\n  handleShowInputChange(val) {\n    if (val) {\n      setTimeout(() => {\n        this.input.triggerFocus();\n      }, 50);\n    }\n  }\n\n  onSubmit(e) {\n    e.preventDefault();\n    e.stopImmediatePropagation();\n    this.updatePrice();\n  }\n\n  render() {\n    const price = this.lineItem()?.price;\n    const variant = this.lineItem()?.variant;\n\n    if (!price) return <Host style={{ display: 'none' }}></Host>;\n\n    return (\n      <div class={{ 'selected-price': true }}>\n        {this.showInput ? (\n          <sc-form\n            onScSubmit={e => this.onSubmit(e)}\n            onScFormSubmit={e => {\n              e.preventDefault();\n              e.stopImmediatePropagation();\n            }}\n          >\n            <sc-price-input\n              ref={el => (this.input = el as HTMLScPriceInputElement)}\n              size=\"large\"\n              currency-code={price?.currency || 'usd'}\n              min={price?.ad_hoc_min_amount}\n              max={price?.ad_hoc_max_amount}\n              placeholder={'0.00'}\n              required={true}\n              value={this.adHocAmount?.toString?.()}\n              onScInput={e => (this.adHocAmount = parseFloat(e.target.value))}\n              onKeyDown={e => {\n                if (e.key === 'Enter') {\n                  this.onSubmit(e);\n                }\n              }}\n            >\n              <sc-button slot=\"suffix\" type=\"link\" submit>\n                {__('Update', 'surecart')}\n              </sc-button>\n            </sc-price-input>\n          </sc-form>\n        ) : (\n          <Fragment>\n            <div class=\"selected-price__wrap\">\n              <span class=\"selected-price__price\" aria-label={__('Product price', 'surecart')}>\n                {price?.scratch_amount > price.amount && (\n                  <Fragment>\n                    <sc-format-number\n                      class=\"selected-price__scratch-price\"\n                      part=\"price__scratch\"\n                      type=\"currency\"\n                      currency={price?.currency}\n                      value={price?.scratch_amount}\n                    ></sc-format-number>{' '}\n                  </Fragment>\n                )}\n                <sc-format-number\n                  type=\"currency\"\n                  currency={price?.currency}\n                  value={this.lineItem()?.ad_hoc_amount !== null ? this.lineItem()?.ad_hoc_amount : variant?.amount || price?.amount}\n                />\n              </span>\n              <span class=\"selected-price__interval\" aria-label={__('Price interval', 'surecart')}>\n                {intervalString(price, {\n                  labels: {\n                    interval: '/',\n                    period:\n                      /** translators: used as in time period: \"for 3 months\" */\n                      __('for', 'surecart'),\n                  },\n                })}\n              </span>\n            </div>\n\n            {price?.ad_hoc && !formBusy() && (\n              <sc-button class=\"selected-price__change-amount\" type=\"primary\" size=\"small\" onClick={() => (this.showInput = true)}>\n                <sc-icon name=\"edit\" slot=\"prefix\"></sc-icon>\n                {__('Change Amount', 'surecart')}\n              </sc-button>\n            )}\n          </Fragment>\n        )}\n      </div>\n    );\n  }\n}\n"]}