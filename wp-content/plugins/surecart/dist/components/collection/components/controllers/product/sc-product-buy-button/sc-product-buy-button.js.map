{"version":3,"file":"sc-product-buy-button.js","sourceRoot":"","sources":["../../../../../src/components/controllers/product/sc-product-buy-button/sc-product-buy-button.tsx"],"names":[],"mappings":"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","sourcesContent":["import { Component, Element, h, Host, Prop, State } from '@stencil/core';\nimport { __ } from '@wordpress/i18n';\nimport { getProductBuyLink, submitCartForm } from '@store/product/mutations';\nimport { state } from '@store/product';\nimport { setProduct } from '@store/product/setters';\nimport { onChange } from '@store/product';\nimport { ScNoticeStore } from '../../../../types';\nimport { isProductOutOfStock, isSelectedVariantMissing } from '@store/product/getters';\nimport { getTopLevelError, getAdditionalErrorMessages } from '../../../../functions/error';\n\n@Component({\n  tag: 'sc-product-buy-button',\n  styleUrl: 'sc-product-buy-button.scss',\n  shadow: false,\n})\nexport class ScProductBuyButton {\n  @Element() el: HTMLScProductBuyButtonElement;\n\n  // Is add to cart enabled\n  @Prop() addToCart: boolean;\n\n  // The product id.\n  @Prop() productId: string;\n\n  // The form id\n  @Prop() formId: number;\n\n  // The mode\n  @Prop() mode: 'live' | 'test' = 'live';\n\n  // checkout link\n  @Prop() checkoutLink: string;\n\n  // Is add to cart enabled\n  @State() error: ScNoticeStore;\n\n  async handleCartClick(e) {\n    e.preventDefault();\n\n    console.log(e);\n\n    // already busy, do nothing.\n    if (state[this.productId]?.busy) return;\n\n    // ad hoc price, use the dialog.\n    if (state[this.productId]?.selectedPrice?.ad_hoc) {\n      setProduct(this.productId, { dialog: this.addToCart ? 'ad_hoc_cart' : 'ad_hoc_buy' });\n      return;\n    }\n\n    // if add to cart is undefined/false navigate to buy url\n    if (!this.addToCart) {\n      const checkoutUrl = window?.scData?.pages?.checkout;\n      if (!checkoutUrl) return;\n      return window.location.assign(getProductBuyLink(this.productId, checkoutUrl, { no_cart: !this.addToCart }));\n    }\n\n    // submit the cart form.\n    try {\n      console.log('submit');\n      await submitCartForm(this.productId);\n    } catch (e) {\n      console.error(e);\n      this.error = e;\n    }\n  }\n\n  componentDidLoad() {\n    this.link = this.el.querySelector('a');\n    this.updateProductLink();\n    onChange(this.productId, () => this.updateProductLink());\n  }\n\n  private link: HTMLAnchorElement;\n\n  updateProductLink() {\n    const checkoutUrl = window?.scData?.pages?.checkout;\n    if (!checkoutUrl || !this.link) return;\n    this.link.href = getProductBuyLink(this.productId, checkoutUrl, !this.addToCart ? { no_cart: true } : {});\n  }\n\n  render() {\n    return (\n      <Host\n        class={{\n          'is-busy': state[this.productId]?.busy && !!this.addToCart,\n          'is-disabled': state[this.productId]?.disabled,\n          'is-sold-out': isProductOutOfStock(this.productId) && !isSelectedVariantMissing(this.productId),\n          'is-unavailable': isSelectedVariantMissing(this.productId),\n        }}\n        onClick={e => this.handleCartClick(e)}\n      >\n        {!!this.error && (\n          <sc-alert\n            onClick={event => {\n              event.stopPropagation();\n            }}\n            type=\"danger\"\n            scrollOnOpen={true}\n            open={!!this.error}\n            closable={false}\n          >\n            {!!getTopLevelError(this.error) && <span slot=\"title\" innerHTML={getTopLevelError(this.error)}></span>}\n            {(getAdditionalErrorMessages(this.error) || []).map((message, index) => (\n              <div innerHTML={message} key={index}></div>\n            ))}\n          </sc-alert>\n        )}\n        <slot />\n      </Host>\n    );\n  }\n}\n"]}