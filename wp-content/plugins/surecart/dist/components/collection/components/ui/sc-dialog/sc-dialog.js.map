{"version":3,"file":"sc-dialog.js","sourceRoot":"","sources":["../../../../src/components/ui/sc-dialog/sc-dialog.tsx"],"names":[],"mappings":"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","sourcesContent":["import { Component, h, Prop, State, Element, Watch, Event, EventEmitter } from '@stencil/core';\nimport { __ } from '@wordpress/i18n';\nimport { animateTo, stopAnimations } from '../../../functions/animate';\nimport { getAnimation, setDefaultAnimation } from '../../../functions/animation-registry';\nimport { lockBodyScrolling, unlockBodyScrolling } from '../../../functions/scroll';\n\n@Component({\n  tag: 'sc-dialog',\n  styleUrl: 'sc-dialog.scss',\n  shadow: true,\n})\nexport class ScDialog {\n  @Element() el!: HTMLElement;\n\n  private dialog: HTMLElement;\n  private panel: HTMLElement;\n  private overlay: HTMLElement;\n\n  private originalTrigger: HTMLElement | null;\n\n  /** Indicates whether or not the dialog is open. You can use this in lieu of the show/hide methods. */\n  @Prop({ reflect: true }) open: boolean = false;\n\n  /**\n   * The dialog's label as displayed in the header. You should always include a relevant label even when using\n   * `no-header`, as it is required for proper accessibility.\n   */\n  @Prop({ reflect: true }) label = '';\n\n  /**\n   * Disables the header. This will also remove the default close button, so please ensure you provide an easy,\n   * accessible way for users to dismiss the dialog.\n   */\n  @Prop({ reflect: true }) noHeader: boolean = false;\n\n  /** Does this have a footer */\n  @State() hasFooter: boolean = false;\n\n  /** Request close event */\n  @Event({ cancelable: true }) scRequestClose: EventEmitter<'close-button' | 'keyboard' | 'overlay'>;\n  @Event() scShow: EventEmitter<void>;\n  @Event() scAfterShow: EventEmitter<void>;\n  @Event() scHide: EventEmitter<void>;\n  @Event() scAfterHide: EventEmitter<void>;\n  @Event({ cancelable: true }) scInitialFocus: EventEmitter<void>;\n\n  /** Shows the dialog. */\n  async show() {\n    if (this.open) {\n      return undefined;\n    }\n    this.open = true;\n  }\n\n  /** Hides the dialog */\n  async hide() {\n    if (!this.open) {\n      return undefined;\n    }\n    this.open = false;\n  }\n\n  private requestClose(source: 'close-button' | 'keyboard' | 'overlay') {\n    const slRequestClose = this.scRequestClose.emit(source);\n\n    if (slRequestClose.defaultPrevented) {\n      const animation = getAnimation(this.el, 'dialog.denyClose');\n      animateTo(this.panel, animation.keyframes, animation.options);\n      return;\n    }\n\n    this.hide();\n  }\n\n  handleKeyDown(event: KeyboardEvent) {\n    if (event.key === 'Escape') {\n      event.stopPropagation();\n      this.requestClose('keyboard');\n    }\n  }\n\n  @Watch('open')\n  async handleOpenChange() {\n    if (this.open) {\n      // Show\n      this.scShow.emit();\n\n      lockBodyScrolling(this.el);\n\n      // When the dialog is shown, Safari will attempt to set focus on whatever element has autofocus. This can cause\n      // the dialogs's animation to jitter (if it starts offscreen), so we'll temporarily remove the attribute, call\n      // `focus({ preventScroll: true })` ourselves, and add the attribute back afterwards.\n      //\n      // Related: https://github.com/shoelace-style/shoelace/issues/693\n      //\n      const autoFocusTarget = this.el.querySelector('[autofocus]');\n      if (autoFocusTarget) {\n        autoFocusTarget.removeAttribute('autofocus');\n      }\n\n      await Promise.all([stopAnimations(this.dialog), stopAnimations(this.overlay)]);\n      this.dialog.hidden = false;\n\n      // Set initial focus\n      requestAnimationFrame(() => {\n        const slInitialFocus = this.scInitialFocus.emit();\n\n        if (!slInitialFocus.defaultPrevented) {\n          // Set focus to the autofocus target and restore the attribute\n          if (autoFocusTarget) {\n            (autoFocusTarget as HTMLInputElement).focus({ preventScroll: true });\n          } else {\n            this.panel.focus({ preventScroll: true });\n          }\n        }\n\n        // Restore the autofocus attribute\n        if (autoFocusTarget) {\n          autoFocusTarget.setAttribute('autofocus', '');\n        }\n      });\n\n      const panelAnimation = getAnimation(this.el, 'dialog.show');\n      const overlayAnimation = getAnimation(this.el, 'dialog.overlay.show');\n      await Promise.all([animateTo(this.panel, panelAnimation.keyframes, panelAnimation.options), animateTo(this.overlay, overlayAnimation.keyframes, overlayAnimation.options)]);\n\n      this.scAfterShow.emit();\n    } else {\n      // Hide\n      this.scHide.emit();\n      await Promise.all([stopAnimations(this.dialog), stopAnimations(this.overlay)]);\n      const panelAnimation = getAnimation(this.el, 'dialog.hide');\n      const overlayAnimation = getAnimation(this.el, 'dialog.overlay.hide');\n      await Promise.all([animateTo(this.panel, panelAnimation.keyframes, panelAnimation.options), animateTo(this.overlay, overlayAnimation.keyframes, overlayAnimation.options)]);\n      this.dialog.hidden = true;\n\n      unlockBodyScrolling(this.el);\n\n      // Restore focus to the original trigger\n      const trigger = this.originalTrigger;\n      if (typeof trigger?.focus === 'function') {\n        setTimeout(() => trigger.focus());\n      }\n\n      this.scAfterHide.emit();\n    }\n  }\n\n  componentDidLoad() {\n    this.hasFooter = !!this.el.querySelector('[slot=\"footer\"]');\n    this.dialog.hidden = !this.open;\n\n    if (this.open) {\n      lockBodyScrolling(this.el);\n    }\n  }\n\n  disconnectedCallback() {\n    unlockBodyScrolling(this.el);\n  }\n\n  render() {\n    return (\n      <div\n        part=\"base\"\n        ref={el => (this.dialog = el as HTMLElement)}\n        class={{\n          'dialog': true,\n          'dialog--open': this.open,\n          'dialog--has-footer': this.hasFooter,\n        }}\n        onKeyDown={e => this.handleKeyDown(e)}\n      >\n        <div\n          part=\"overlay\"\n          class=\"dialog__overlay\"\n          onClick={e => {\n            e.preventDefault();\n            e.stopImmediatePropagation();\n            this.requestClose('overlay');\n          }}\n          ref={el => (this.overlay = el as HTMLElement)}\n          tabindex=\"-1\"\n        ></div>\n        <div\n          part=\"panel\"\n          class=\"dialog__panel\"\n          role=\"dialog\"\n          aria-modal=\"true\"\n          aria-hidden={this.open ? 'false' : 'true'}\n          aria-label={this.noHeader || this.label}\n          aria-labelledby={!this.noHeader || 'title'}\n          ref={el => (this.panel = el as HTMLElement)}\n          tabindex=\"0\"\n        >\n          {!this.noHeader && (\n            <header part=\"header\" class=\"dialog__header\">\n              <h2 part=\"title\" class=\"dialog__title\" id=\"title\">\n                <slot name=\"label\"> {this.label.length > 0 ? this.label : String.fromCharCode(65279)} </slot>\n              </h2>\n              <sc-button\n                class=\"dialog__close\"\n                type=\"text\"\n                circle\n                part=\"close-button\"\n                exportparts=\"base:close-button__base\"\n                onClick={e => {\n                  e.preventDefault();\n                  e.stopImmediatePropagation();\n                  this.requestClose('close-button');\n                }}\n              >\n                <sc-icon name=\"x\" label={__('Close', 'surecart')}></sc-icon>\n              </sc-button>\n            </header>\n          )}\n          <div part=\"body\" class=\"dialog__body\">\n            <slot></slot>\n          </div>\n          <footer part=\"footer\" class=\"dialog__footer\">\n            <slot name=\"footer\"></slot>\n          </footer>\n        </div>\n      </div>\n    );\n  }\n}\n\nsetDefaultAnimation('dialog.show', {\n  keyframes: [\n    { opacity: 0, transform: 'scale(0.8)' },\n    { opacity: 1, transform: 'scale(1)' },\n  ],\n  options: { duration: 150, easing: 'ease' },\n});\n\nsetDefaultAnimation('dialog.hide', {\n  keyframes: [\n    { opacity: 1, transform: 'scale(1)' },\n    { opacity: 0, transform: 'scale(0.8)' },\n  ],\n  options: { duration: 150, easing: 'ease' },\n});\n\nsetDefaultAnimation('dialog.denyClose', {\n  keyframes: [{ transform: 'scale(1)' }, { transform: 'scale(1.02)' }, { transform: 'scale(1)' }],\n  options: { duration: 150 },\n});\n\nsetDefaultAnimation('dialog.overlay.show', {\n  keyframes: [{ opacity: 0 }, { opacity: 1 }],\n  options: { duration: 150 },\n});\n\nsetDefaultAnimation('dialog.overlay.hide', {\n  keyframes: [{ opacity: 1 }, { opacity: 0 }],\n  options: { duration: 150 },\n});\n"]}