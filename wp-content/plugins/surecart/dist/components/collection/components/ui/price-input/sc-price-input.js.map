{"version":3,"file":"sc-price-input.js","sourceRoot":"","sources":["../../../../src/components/ui/price-input/sc-price-input.tsx"],"names":[],"mappings":"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","sourcesContent":["import { Component, Prop, Event, EventEmitter, h, Method, Watch, Element } from '@stencil/core';\nimport { getCurrencySymbol } from '../../../functions/price';\nimport { FormSubmitController } from '../../../functions/form-data';\nimport { isZeroDecimal, maybeConvertAmount } from '../../../functions/currency';\nimport { sprintf, __ } from '@wordpress/i18n';\n\n/**\n * @part base - The elements base wrapper.\n * @part input - The html input element.\n * @part base - The elements base wrapper.\n * @part prefix - Used to prepend an icon or element to the input.\n * @part suffix - Used to prepend an icon or element to the input.\n * @part help-text - Help text that describes how to use the input.\n */\n@Component({\n  tag: 'sc-price-input',\n  styleUrl: 'sc-price-input.css',\n  shadow: true,\n})\nexport class ScPriceInput {\n  @Element() el: HTMLScPriceInputElement;\n  private input: HTMLScInputElement;\n\n  private formController: any;\n\n  /** The input's size. */\n  @Prop({ reflect: true }) size: 'small' | 'medium' | 'large' = 'medium';\n\n  /** The input's name attribute. */\n  @Prop() name: string;\n\n  /** The input's value attribute. */\n  @Prop({ mutable: true }) value = '';\n\n  /** Draws a pill-style input with rounded edges. */\n  @Prop({ reflect: true }) pill = false;\n\n  /** The input's label. */\n  @Prop() label: string;\n\n  /** Should we show the label */\n  @Prop() showLabel: boolean = true;\n\n  /** The input's help text. */\n  @Prop() help: string = '';\n\n  /** Adds a clear button when the input is populated. */\n  @Prop() clearable = false;\n\n  /** The input's placeholder text. */\n  @Prop() placeholder: string;\n\n  /** Disables the input. */\n  @Prop({ reflect: true }) disabled: boolean = false;\n\n  /** Makes the input readonly. */\n  @Prop({ reflect: true }) readonly: boolean = false;\n\n  /** The minimum length of input that will be considered valid. */\n  @Prop() minlength: number;\n\n  /** The maximum length of input that will be considered valid. */\n  @Prop() maxlength: number;\n\n  /** The input's maximum value. */\n  @Prop({ reflect: true }) max: number;\n\n  /** The input's minimum value. */\n  @Prop({ reflect: true }) min: number;\n\n  /** Makes the input a required field. */\n  @Prop({ reflect: true }) required = false;\n\n  /**\n   * This will be true when the control is in an invalid state. Validity is determined by props such as `type`,\n   * `required`, `minlength`, `maxlength`, and `pattern` using the browser's constraint validation API.\n   */\n  @Prop({ mutable: true, reflect: true }) invalid = false;\n\n  /** The input's autofocus attribute. */\n  @Prop() autofocus: boolean;\n\n  /** Inputs focus */\n  @Prop({ mutable: true, reflect: true }) hasFocus: boolean;\n\n  /** 3 letter currency code for input */\n  @Prop({ reflect: true }) currencyCode: string;\n\n  /** Show the currency code with the input */\n  @Prop() showCode: boolean;\n\n  /** Emitted when the control's value changes. */\n  @Event({ composed: true })\n  scChange: EventEmitter<void>;\n\n  /** Emitted when the control's value changes. */\n  @Event({ composed: true })\n  scInput: EventEmitter<void>;\n\n  /** Emitted when the control gains focus. */\n  @Event() scFocus: EventEmitter<void>;\n\n  /** Emitted when the control loses focus. */\n  @Event() scBlur: EventEmitter<void>;\n\n  @Method()\n  async reportValidity() {\n    const input = this.input.shadowRoot.querySelector('input');\n    input.setCustomValidity('');\n    if (this.min && this.value && parseFloat(this.value) < this.min) {\n      this.invalid = true;\n      input.setCustomValidity(sprintf(__('Must be %d or more.', 'surecart'), maybeConvertAmount(this.min, this.currencyCode).toString()));\n    }\n    if (this.max && this.value && parseFloat(this.value) > this.max) {\n      this.invalid = true;\n      input.setCustomValidity(sprintf(__('Must be %d or less.', 'surecart'), maybeConvertAmount(this.max, this.currencyCode).toString()));\n    }\n    return input.reportValidity();\n  }\n\n  /** Sets focus on the input. */\n  @Method()\n  async triggerFocus(options?: FocusOptions) {\n    return this.input.triggerFocus(options);\n  }\n\n  /** Sets a custom validation message. If `message` is not empty, the field will be considered invalid. */\n  @Method()\n  async setCustomValidity(message: string) {\n    this.input.setCustomValidity(message);\n  }\n\n  /** Removes focus from the input. */\n  @Method()\n  async triggerBlur() {\n    return this.input.blur();\n  }\n\n  @Watch('hasFocus')\n  handleFocusChange() {\n    this.hasFocus ? this.input?.focus?.() : this.input?.blur?.();\n  }\n\n  handleChange() {\n    this.updateValue();\n    this.scChange.emit();\n  }\n\n  handleInput() {\n    this.updateValue();\n    this.scInput.emit();\n  }\n\n  updateValue() {\n    // This fixes issues on mobile Safari where a decimal point is added to the end of the input value\n    // does not have an input value.\n    const parsed = parseFloat(this.input.value);\n    if (isNaN(parsed)) {\n      this.value = '';\n      return;\n    }\n    const val = isZeroDecimal(this.currencyCode) ? parsed : (parsed * 100).toFixed(2);\n    this.value = val.toString();\n    this.setCustomValidity('');\n  }\n\n  componentDidLoad() {\n    this.handleFocusChange();\n    this.formController = new FormSubmitController(this.el).addFormData();\n    document.addEventListener('wheel', () => {\n      this.input.triggerBlur();\n    });\n  }\n\n  disconnectedCallback() {\n    this.formController?.removeFormData();\n  }\n\n  getFormattedValue() {\n    if (!this.value) return '';\n\n    const parsedAmount = parseFloat(this.value);\n    if (isNaN(parsedAmount)) return '';\n\n    return maybeConvertAmount(parsedAmount, this.currencyCode).toString();\n  }\n\n  render() {\n    return (\n      <sc-input\n        exportparts=\"base, input, form-control, label, help-text, prefix, suffix\"\n        size={this.size}\n        label={this.label}\n        showLabel={this.showLabel}\n        help={this.help}\n        ref={el => (this.input = el as HTMLScInputElement)}\n        type=\"text\" // we cannot use number because it's basically the worst. https://stackoverflow.blog/2022/12/26/why-the-number-input-is-the-worst-input/\n        name={this.name}\n        disabled={this.disabled}\n        readonly={this.readonly}\n        required={this.required}\n        placeholder={this.placeholder}\n        minlength={this.minlength}\n        maxlength={this.maxlength}\n        min={!!this.min ? this.min / 100 : 0.0}\n        step={0.01}\n        max={!!this.max ? this.max / 100 : null}\n        // TODO: Test These below\n        autofocus={this.autofocus}\n        inputmode={'decimal'}\n        onScChange={() => this.handleChange()}\n        onScInput={() => this.handleInput()}\n        onScBlur={() => this.scBlur.emit()}\n        onScFocus={() => this.scFocus.emit()}\n        pattern=\"^\\d*(\\.\\d{0,2})?$\" // This prevents more than two decimal places\n        value={this.getFormattedValue()}\n      >\n        <span style={{ opacity: '0.5' }} slot=\"prefix\">\n          {getCurrencySymbol(this.currencyCode)}\n        </span>\n\n        <span slot=\"suffix\">\n          <slot name=\"suffix\">{this.showCode && this?.currencyCode && <span style={{ opacity: '0.5' }}>{this.currencyCode.toUpperCase()}</span>}</slot>\n        </span>\n      </sc-input>\n    );\n  }\n}\n"]}