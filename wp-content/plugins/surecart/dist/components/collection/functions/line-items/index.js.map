{"version":3,"file":"index.js","sourceRoot":"","sources":["../../../src/functions/line-items/index.ts"],"names":[],"mappings":"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","sourcesContent":["import { getQueryArg } from '@wordpress/url';\n\nimport { Bump, Checkout, ChoiceType, LineItemData, lineItems, Price, PriceChoice, Product, RecursivePartial } from '../../types';\n\n// Get only enabled price choices.\nexport const getEnabledPriceChoices = (choices: Array<PriceChoice>): Array<PriceChoice> => {\n  return (choices || []).filter(choice => choice?.enabled !== false);\n};\n\n// convert price choice to line item data.\nexport const convertPriceChoiceToLineItemData = (choice: PriceChoice): LineItemData => {\n  return {\n    price_id: choice.id,\n    quantity: choice.quantity,\n  };\n};\n\nexport const convertLineItemsToLineItemData = (\n  lineItems: RecursivePartial<lineItems>,\n): Array<{\n  price_id: string;\n  quantity: number;\n  variant_id?: string;\n}> => {\n  return (lineItems?.data || []).map(item => {\n    return {\n      ...(!!item?.id ? { id: item.id } : {}),\n      price_id: item.price.id,\n      quantity: item.quantity,\n      variant_id: item.variant?.id,\n    };\n  });\n};\n\nexport const addLineItem = (lineItems: RecursivePartial<lineItems>, data: { price_id: string; quantity: number }) => {\n  const lineItemData = convertLineItemsToLineItemData(lineItems);\n  const index = lineItemData.findIndex(item => item.price_id === data.price_id);\n  lineItemData[index] = data;\n  return lineItemData;\n};\n/**\n * Calculates the initial line items for the session.\n */\nexport const calculateInitialLineItems = (choices: Array<PriceChoice>, choiceType: ChoiceType) => {\n  // check the url query first.\n  const prices = getQueryArg(window.location.href, 'prices') as unknown as Array<PriceChoice>;\n  if (prices) {\n    return prices.map(convertPriceChoiceToLineItemData);\n  }\n\n  // get prices from choices.\n  return getInitialChoiceLineItems(choices, choiceType);\n};\n\n/**\n * Get the initial choice line items.\n */\nexport const getInitialChoiceLineItems = (choices: Array<PriceChoice>, choiceType: ChoiceType) => {\n  if (choiceType === 'all') {\n    return getEnabledPriceChoices(choices).map(convertPriceChoiceToLineItemData);\n  } else {\n    return [getEnabledPriceChoices(choices).map(convertPriceChoiceToLineItemData)?.[0]];\n  }\n};\n\n/**\n * Get price ids from line items\n * @param order\n * @returns\n */\nexport const getLineItemPriceIds = (line_items: RecursivePartial<lineItems>) => {\n  return (line_items?.data || []).map(item => item.price.id);\n};\n\nexport const getLineItemBumpIds = (line_items: RecursivePartial<lineItems>) => {\n  return (line_items?.data || []).map(item => (item?.bump as Bump)?.id || (item?.bump as string));\n};\n\nexport const getLineItemPrices = (line_items: RecursivePartial<lineItems>) => {\n  return (line_items?.data || []).map(item => item.price);\n};\n\nexport const getLineItemByPriceId = (line_items: RecursivePartial<lineItems>, priceId: string) => {\n  return (line_items?.data || []).find(item => item.price.id === priceId);\n};\n\n/**\n * Is this product in the checkout session?\n */\nexport const isProductInOrder = (product: RecursivePartial<Product>, order: Checkout) => {\n  const prices = getLineItemPrices(order?.line_items);\n  if (!prices?.length) return false;\n  return !!prices.find(price => (price?.product as Product)?.id === product.id);\n};\n\n/**\n * Is the price in a checkout session\n */\nexport const isPriceInOrder = (price: RecursivePartial<Price>, order: Checkout) => {\n  const priceIds = getLineItemPriceIds(order?.line_items);\n  return !!priceIds.find(id => price?.id === id);\n};\n\n/**\n * Is the price in a checkout session\n */\nexport const isBumpInOrder = (bump: RecursivePartial<Bump>, order: Checkout) => {\n  const bumpIds = getLineItemBumpIds(order?.line_items);\n  return !!bumpIds.find(id => bump?.id === id);\n};\n\n/**\n * Attempt to get the session id\n *\n * @param formId The form id.\n * @param order The order\n * @param refresh Should we refresh?\n *\n * @returns string\n */\nexport const getSessionId = (formId, order, refresh = false) => {\n  // if we want to get a fresh session, skip\n  if (refresh === true) {\n    return false;\n  }\n\n  // if we already have an ID set, return that:\n  if (order?.id) {\n    return order.id;\n  }\n\n  // check the url query first\n  const urlId = getQueryArg(window.location.href, 'order');\n  if (urlId) {\n    return urlId;\n  }\n\n  // check id in localstorage\n  return window.localStorage.getItem(formId);\n};\n\n/** Check if the order has a subscription */\nexport const hasSubscription = (order: Checkout) => {\n  // no line items.\n  if (!order?.line_items?.data?.length) return false;\n  // has subscription product.\n  return order?.line_items.data?.some(item => item?.price?.recurring_interval_count);\n};\n\nexport const hasTrial = (order: Checkout) => {\n  return order?.trial_amount;\n};\n\n/** Check if the order has a payment plan. */\nexport const hasPaymentPlan = (order: Checkout) => {\n  return hasSubscription(order) && order?.line_items.data?.some(item => item?.price?.recurring_period_count);\n};\n"]}