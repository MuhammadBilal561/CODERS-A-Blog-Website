{"version":3,"names":["t","n","e","Symbol","iterator","r","o","i","call","a","next","done","push","value","error","return","NotStarted","Running","Stopped","type","concat","assignment","name","exec","u","c","context","actions","changed","matches","f","filter","Object","assign","keys","forEach","s","states","initial","entry","map","l","v","y","config","_options","initialState","transition","p","g","d","x","on","m","h","length","TypeError","b","S","w","target","j","E","R","N","cond","O","_","k","T","q","exit","z","A","B","C","Set","_machine","send","subscribe","add","unsubscribe","delete","start","stop","clear","state","status","checkoutMachine","createMachine","id","retries","draft","PAID","FINALIZE","FETCH","REJECT","updating","RESOLVE","EXPIRE","finalizing","PAYING","paying","confirming","CONFIRMED","paid","REDIRECT","expired","confirmed","redirecting","failure","RETRY","form","getSerializedState","wp","i18n","__"],"sources":["../../node_modules/@xstate/fsm/es/index.js","./src/components/providers/form-state-provider/checkout-machine.ts","./src/store/form/store.ts"],"sourcesContent":["/*! *****************************************************************************\nCopyright (c) Microsoft Corporation.\n\nPermission to use, copy, modify, and/or distribute this software for any\npurpose with or without fee is hereby granted.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\nPERFORMANCE OF THIS SOFTWARE.\n***************************************************************************** */\nfunction t(t,n){var e=\"function\"==typeof Symbol&&t[Symbol.iterator];if(!e)return t;var r,o,i=e.call(t),a=[];try{for(;(void 0===n||n-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(t){o={error:t}}finally{try{r&&!r.done&&(e=i.return)&&e.call(i)}finally{if(o)throw o.error}}return a}var n;!function(t){t[t.NotStarted=0]=\"NotStarted\",t[t.Running=1]=\"Running\",t[t.Stopped=2]=\"Stopped\"}(n||(n={}));var e={type:\"xstate.init\"};function r(t){return void 0===t?[]:[].concat(t)}function o(t){return{type:\"xstate.assign\",assignment:t}}function i(t,n){return\"string\"==typeof(t=\"string\"==typeof t&&n&&n[t]?n[t]:t)?{type:t}:\"function\"==typeof t?{type:t.name,exec:t}:t}function a(t){return function(n){return t===n}}function u(t){return\"string\"==typeof t?{type:t}:t}function c(t,n){return{value:t,context:n,actions:[],changed:!1,matches:a(t)}}function f(t,n,e){var r=n,o=!1;return[t.filter((function(t){if(\"xstate.assign\"===t.type){o=!0;var n=Object.assign({},r);return\"function\"==typeof t.assignment?n=t.assignment(r,e):Object.keys(t.assignment).forEach((function(o){n[o]=\"function\"==typeof t.assignment[o]?t.assignment[o](r,e):t.assignment[o]})),r=n,!1}return!0})),r,o]}function s(n,o){void 0===o&&(o={});var s=t(f(r(n.states[n.initial].entry).map((function(t){return i(t,o.actions)})),n.context,e),2),l=s[0],v=s[1],y={config:n,_options:o,initialState:{value:n.initial,actions:l,context:v,matches:a(n.initial)},transition:function(e,o){var s,l,v=\"string\"==typeof e?{value:e,context:n.context}:e,p=v.value,g=v.context,d=u(o),x=n.states[p];if(x.on){var m=r(x.on[d.type]);try{for(var h=function(t){var n=\"function\"==typeof Symbol&&Symbol.iterator,e=n&&t[n],r=0;if(e)return e.call(t);if(t&&\"number\"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(n?\"Object is not iterable.\":\"Symbol.iterator is not defined.\")}(m),b=h.next();!b.done;b=h.next()){var S=b.value;if(void 0===S)return c(p,g);var w=\"string\"==typeof S?{target:S}:S,j=w.target,E=w.actions,R=void 0===E?[]:E,N=w.cond,O=void 0===N?function(){return!0}:N,_=void 0===j,k=null!=j?j:p,T=n.states[k];if(O(g,d)){var q=t(f((_?r(R):[].concat(x.exit,R,T.entry).filter((function(t){return t}))).map((function(t){return i(t,y._options.actions)})),g,d),3),z=q[0],A=q[1],B=q[2],C=null!=j?j:p;return{value:C,context:A,actions:z,changed:j!==p||z.length>0||B,matches:a(C)}}}}catch(t){s={error:t}}finally{try{b&&!b.done&&(l=h.return)&&l.call(h)}finally{if(s)throw s.error}}}return c(p,g)}};return y}var l=function(t,n){return t.actions.forEach((function(e){var r=e.exec;return r&&r(t.context,n)}))};function v(t){var r=t.initialState,o=n.NotStarted,i=new Set,c={_machine:t,send:function(e){o===n.Running&&(r=t.transition(r,e),l(r,u(e)),i.forEach((function(t){return t(r)})))},subscribe:function(t){return i.add(t),t(r),{unsubscribe:function(){return i.delete(t)}}},start:function(i){if(i){var u=\"object\"==typeof i?i:{context:t.config.context,value:i};r={value:u.value,actions:[],context:u.context,matches:a(u.value)}}return o=n.Running,l(r,e),c},stop:function(){return o=n.Stopped,i.clear(),c},get state(){return r},get status(){return o}};return c}export{n as InterpreterStatus,o as assign,s as createMachine,v as interpret};\n","import { createMachine, assign } from '@xstate/fsm';\n\nexport const checkoutMachine = createMachine({\n  id: 'fetch',\n  initial: 'draft',\n  context: {\n    retries: 3,\n  },\n  states: {\n    draft: {\n      on: {\n        PAID: 'confirming',\n        FINALIZE: 'finalizing',\n        FETCH: 'updating',\n        REJECT: 'draft',\n      },\n    },\n    updating: {\n      on: {\n        RESOLVE: 'draft',\n        EXPIRE: 'expired',\n        REJECT: 'draft',\n      },\n    },\n    finalizing: {\n      on: {\n        PAYING: 'paying',\n        REJECT: 'draft',\n        PAID: 'confirming',\n      },\n    },\n    paying: {\n      on: {\n        PAID: 'confirming',\n        REJECT: 'draft',\n      },\n    },\n    confirming: {\n      on: {\n        CONFIRMED: 'confirmed',\n      },\n    },\n    paid: {\n      on: {\n        CONFIRMED: 'confirmed',\n        REDIRECT: 'redirecting',\n        REJECT: 'draft',\n      },\n    },\n    expired: {},\n    confirmed: {\n      on: {\n        REDIRECT: 'redirecting',\n      },\n    },\n    redirecting: {},\n    failure: {\n      on: {\n        RETRY: {\n          target: 'updating',\n          actions: assign({\n            retries: (context: { retries: number }) => context.retries + 1,\n          }),\n        },\n      },\n    },\n  },\n});\n\nexport default checkoutMachine;\n","import { createStore } from '@stencil/store';\nimport { checkoutMachine } from '../../../src/components/providers/form-state-provider/checkout-machine';\nimport { __ } from '@wordpress/i18n';\nimport { getSerializedState } from '@store/utils';\nconst { form } = getSerializedState();\n\ninterface Store {\n  formState: any;\n  text: {\n    loading: {\n      finalizing: string;\n      paying: string;\n      confirming: string;\n      confirmed: string;\n      redirecting: string;\n    };\n    success: {\n      title: string;\n      description: string;\n      button: string;\n    };\n  };\n}\n\nconst { state, onChange, on, set, get, dispose } = createStore<Store>(\n  {\n    formState: checkoutMachine.initialState,\n    text: {\n      loading: {\n        finalizing: __('Submitting...', 'surecart'),\n        paying: __('Processing...', 'surecart'),\n        confirming: __('Finalizing...', 'surecart'),\n        confirmed: __('Success!', 'surecart'),\n        redirecting: __('Success! Redirecting...', 'surecart'),\n      },\n      success: {\n        title: __('Thank you!', 'surecart'),\n        description: __('Your payment was successful. A receipt is on its way to your inbox.', 'surecart'),\n        button: __('Continue', 'surecart'),\n      },\n    },\n    ...form,\n  },\n  (newValue, oldValue, propChanged) => {\n    if (propChanged === 'formState') {\n      return newValue.value !== oldValue.value;\n    }\n    return JSON.stringify(newValue) !== JSON.stringify(oldValue);\n  },\n);\n\nexport default state;\nexport { state, onChange, on, set, get, dispose };\n"],"mappings":"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"}