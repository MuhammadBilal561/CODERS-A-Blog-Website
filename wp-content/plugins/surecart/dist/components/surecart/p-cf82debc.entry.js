import{r as t,h as e,H as s}from"./p-cc7ce8c7.js";import{s as n}from"./p-38a11668.js";import{a}from"./p-18e45a13.js";import"./p-1c2e2695.js";const i=":host{display:block}";const r=class{constructor(e){t(this,e);this.liveMode=true;this.customerId=undefined;this.successUrl=undefined;this.currency=undefined;this.loading=undefined;this.loaded=undefined;this.error=undefined;this.paymentIntent=undefined}async handlePaymentIntentCreate(){var t,e;const{public_key:s,access_code:a}=((e=(t=this.paymentIntent)===null||t===void 0?void 0:t.processor_data)===null||e===void 0?void 0:e.paystack)||{};if(!s||!a)return;const i=new n;await i.newTransaction({key:s,accessCode:a,onSuccess:async t=>{if((t===null||t===void 0?void 0:t.status)!=="success"){throw{message:wp.i18n.sprintf(wp.i18n.__("Paystack transaction could not be finished. Status: %s","surecart"),t===null||t===void 0?void 0:t.status)}}window.location.assign(this.successUrl)},onClose:t=>{console.error(t);alert((t===null||t===void 0?void 0:t.message)||wp.i18n.__("The payment did not process. Please try again.","surecart"))}})}async createPaymentIntent(){var t,e;try{this.loading=true;this.error="";this.paymentIntent=await a({method:"POST",path:"surecart/v1/payment_intents",data:{processor_type:"paystack",reusable:true,live_mode:this.liveMode,customer_id:this.customerId,currency:this.currency,refresh_status:true}})}catch(s){this.error=((e=(t=s===null||s===void 0?void 0:s.additional_errors)===null||t===void 0?void 0:t[0])===null||e===void 0?void 0:e.message)||(s===null||s===void 0?void 0:s.message)||wp.i18n.__("Something went wrong","surecart")}finally{this.loading=false}}render(){return e(s,null,this.error&&e("sc-alert",{open:!!this.error,type:"danger"},e("span",{slot:"title"},wp.i18n.__("Error","surecart")),this.error),e("div",{class:"sc-paystack-button-container"},e("sc-alert",{open:true,type:"warning"},wp.i18n.__("In order to add a new card, we will need to make a small transaction to authenticate it. This is for authentication purposes and will be immediately refunded.","surecart"),e("div",null,e("sc-button",{loading:this.loading,type:"primary",onClick:()=>this.createPaymentIntent(),style:{marginTop:"var(--sc-spacing-medium)"}},wp.i18n.__("Add New Card","surecart"))))))}static get watchers(){return{paymentIntent:["handlePaymentIntentCreate"]}}};r.style=i;export{r as sc_paystack_add_method};
//# sourceMappingURL=p-cf82debc.entry.js.map