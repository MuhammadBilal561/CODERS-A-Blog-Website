import{c as o}from"./p-25433d0f.js";import"./p-72df1f47.js";import{i,a as l,g as d}from"./p-f70181c4.js";import{g as v}from"./p-c06b2e12.js";import{s as n}from"./p-830ab1a3.js";const u=(i,l,o=1)=>{var d;const t=new CustomEvent("scProductViewed",{detail:{id:null==i?void 0:i.id,name:null==i?void 0:i.name,price:l,permalink:null==i?void 0:i.permalink,prices:null==i?void 0:i.prices,variant_options:null===(d=null==i?void 0:i.variant_options)||void 0===d?void 0:d.data,product_collections:null==i?void 0:i.product_collections,quantity:o},bubbles:!0});document.dispatchEvent(t)},t=i=>{var l;return((null===(l=j[i])||void 0===l?void 0:l.prices)||[]).filter((i=>!(null==i?void 0:i.archived))).sort(((i,l)=>(null==i?void 0:i.position)-(null==l?void 0:l.position)))},a=i=>{var l;return null!==(l=j[i])&&void 0!==l?l:null},s=i=>{var l,o,d,t;return!(!(null===(o=null===(l=null==j?void 0:j[i])||void 0===l?void 0:l.product)||void 0===o?void 0:o.stock_enabled)||(null===(t=null===(d=null==j?void 0:j[i])||void 0===d?void 0:d.product)||void 0===t?void 0:t.allow_out_of_stock_purchases))},e=(l,o,d)=>i(o,d,j[l].variantValues,j[l].product),r=(i,o,d)=>l(o,d,j[i].variantValues,j[i].product),c=i=>{var l,o,d,t;return!!s(i)&&((null===(o=null===(l=null==j?void 0:j[i])||void 0===l?void 0:l.selectedVariant)||void 0===o?void 0:o.id)?(null===(t=j[i].selectedVariant)||void 0===t?void 0:t.available_stock)<=0:(null===(d=j[i].product)||void 0===d?void 0:d.available_stock)<=0)},p=i=>{var l,o,d;return!!(null===(o=null===(l=null==j?void 0:j[i])||void 0===l?void 0:l.variants)||void 0===o?void 0:o.length)&&void 0===(null===(d=v({variants:j[i].variants,values:j[i].variantValues}))||void 0===d?void 0:d.id)},f=()=>{const{product:i={}}=d();return Object.values(i).reduce(((i,l)=>{const{selectedPrice:o,product:d,selectedVariant:t}=l||{},n={...l,quantity:1,total:null,dialog:null,busy:!1,error:null,adHocAmount:(null==o?void 0:o.amount)||null,disabled:(null==o?void 0:o.archived)||(null==d?void 0:d.archived),line_item:{price_id:null==o?void 0:o.id,quantity:1,...(null==o?void 0:o.ad_hoc)?{ad_hoc_amount:null==o?void 0:o.amount}:{},...(null==t?void 0:t.id)?{variant_id:null==t?void 0:t.id}:{}},variantValues:{...(null==t?void 0:t.option_1)?{option_1:null==t?void 0:t.option_1}:{},...(null==t?void 0:t.option_2)?{option_2:null==t?void 0:t.option_2}:{},...(null==t?void 0:t.option_3)?{option_3:null==t?void 0:t.option_3}:{}}};return i[d.id]=n,i}),{})||{}},m=i=>(t(i)||[]).filter((i=>null==i?void 0:i.recurring_interval)).sort(((i,l)=>(null==i?void 0:i.position)-(null==l?void 0:l.position))),b=i=>(t(i)||[]).filter((i=>!(null==i?void 0:i.recurring_interval))).sort(((i,l)=>(null==i?void 0:i.position)-(null==l?void 0:l.position))),_=Object.freeze({__proto__:null,availablePrices:t,getProduct:a,isStockNeedsToBeChecked:s,isOptionSoldOut:e,isOptionMissing:r,isProductOutOfStock:c,isSelectedVariantMissing:p,getDefaultState:f,availableSubscriptionPrices:m,availableNonSubscriptionPrices:b}),O=f();Object.values(O).filter((i=>null==i?void 0:i.isProductPage)).forEach((i=>{var l;(null===(l=null==i?void 0:i.product)||void 0===l?void 0:l.id)&&u(null==i?void 0:i.product,null==i?void 0:i.selectedPrice,null==i?void 0:i.quantity)}));const S=o(O,((i,l)=>JSON.stringify(i)!==JSON.stringify(l))),{state:j,onChange:g,on:h,dispose:N,forceUpdate:P}=S,y=(i,l)=>{i&&(j[i]={...j[i],...l})};h("set",((i,l,o)=>{var d,t,n,e;(null===(d=null==l?void 0:l.selectedPrice)||void 0===d?void 0:d.id)!==(null===(t=null==o?void 0:o.selectedPrice)||void 0===t?void 0:t.id)&&V(i,l),(null===(n=null==l?void 0:l.selectedVariant)||void 0===n?void 0:n.id)!==(null===(e=null==o?void 0:o.selectedVariant)||void 0===e?void 0:e.id)&&J(i);const a=!o||["selectedPrice","adHocAmount","quantity","selectedVariant"].some((i=>JSON.stringify(l[i])!==JSON.stringify(o[i])));a&&k(i),(!o||JSON.stringify(null==l?void 0:l.variantValues)!==JSON.stringify(null==o?void 0:o.variantValues))&&q(i,l)}));const q=(i,l)=>{const o=v({variants:j[i].variants,values:null==l?void 0:l.variantValues});o&&y(i,{selectedVariant:o})},J=i=>{var l,o,d;j[i].selectedVariant&&s&&(null===(l=j[i])||void 0===l?void 0:l.selectedVariant.available_stock)<(null===(o=j[i])||void 0===o?void 0:o.quantity)&&(j[i].quantity=(null===(d=j[i])||void 0===d?void 0:d.selectedVariant.available_stock)||1,n(wp.i18n.sprintf(wp.i18n.__("There are just %d items left in stock, and the quantity has been adjusted to %d.","surecart"),j[i].quantity,j[i].quantity),"assertive"))},V=(i,l)=>{var o,d,t,n;y(i,{total:j[i].adHocAmount||(null===(o=null==l?void 0:l.selectedPrice)||void 0===o?void 0:o.amount)||0,adHocAmount:null===(d=null==l?void 0:l.selectedPrice)||void 0===d?void 0:d.amount,disabled:(null===(t=null==l?void 0:l.selectedPrice)||void 0===t?void 0:t.archived)||(null===(n=j[i].product)||void 0===n?void 0:n.archived)})},k=i=>{var l,o,d,t,n,e,a,v;y(i,{line_item:{price_id:null===(o=null===(l=j[i])||void 0===l?void 0:l.selectedPrice)||void 0===o?void 0:o.id,quantity:Math.max((null===(t=null===(d=j[i])||void 0===d?void 0:d.selectedPrice)||void 0===t?void 0:t.ad_hoc)?1:j[i].quantity,1),...(null===(e=null===(n=j[i])||void 0===n?void 0:n.selectedPrice)||void 0===e?void 0:e.ad_hoc)?{ad_hoc_amount:null===(a=j[i])||void 0===a?void 0:a.adHocAmount}:{},variant:null===(v=j[i].selectedVariant)||void 0===v?void 0:v.id}})};export{h as a,y as b,p as c,N as d,e,P as f,_ as g,r as h,c as i,t as j,g as o,j as s};