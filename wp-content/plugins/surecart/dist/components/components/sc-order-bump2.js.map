{"file":"sc-order-bump2.js","mappings":";;;;;;;;;;;AAAA,MAAM,cAAc,GAAG,2pDAA2pD;;;;;;;;;;;;;;;;;;;;;;;;YCwCtqD,UAAE;;;;;;;YAMF,UAAE;;;;;;;;;;;;;;;;;;;;;;uIAwBoF,UAAE;;;;;;;;;MAWxF,eAAO,CACL,UAAE;;;4aAiBsB,UAAE;;;;;;;QAkB5B,eAAO,CAAC,UAAE,4NAIT,UAAE;;;;;QAYH,eAAO,CAAC,UAAE,8IAGc,eAAO,CAAC,UAAE;;;;;;;;;;;;;iMA8BpB,eAAO;;MAEjB,UAAE,2tDA4Bc,eAAO;;MAEjB,UAAE;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","names":[],"sources":["./src/components/controllers/checkout-form/sc-order-bump/sc-order-bump.scss?tag=sc-order-bump&encapsulation=shadow","./src/components/controllers/checkout-form/sc-order-bump/sc-order-bump.tsx"],"sourcesContent":[":host {\n  display: block;\n}\n\n.bump {\n  display: grid;\n  gap: 1em;\n\n  &__text {\n    display: grid;\n    gap: 0.25em;\n  }\n  &__tag {\n    background: var(--sc-color-primary-500);\n    color: var(--sc-color-white);\n    border-radius: var(--sc-input-border-radius-medium);\n    padding: var(--sc-spacing-x-small);\n    font-size: var(--sc-font-size-x-small);\n  }\n\n  &__product {\n    display: flex;\n    align-items: center;\n    gap: var(--sc-choice-padding, 1.3em 1.1em);\n    line-height: var(--sc-line-height-dense);\n    &--wrapper {\n      container-type: inline-size;\n    }\n    @container (max-width: 325px) {\n      flex-direction: column;\n      align-items: start;\n    }\n  }\n\n  &__product-title {\n    font-weight: var(--sc-font-weight-semibold);\n  }\n\n  &__product-description {\n    color: var(--sc-input-label-color);\n  }\n\n  &__image {\n    width: var(--sc-product-line-item-image-size, 4em);\n    height: var(--sc-product-line-item-image-size, 4em);\n    flex: 0 0 var(--sc-product-line-item-image-size, 4em);\n    object-fit: cover;\n    border-radius: 4px;\n    border: 1px solid var(--sc-color-gray-200);\n    display: block;\n    box-shadow: var(--sc-input-box-shadow);\n  }\n\n  &__price {\n    &--has-discount .bump__original-price {\n      text-decoration: line-through;\n      color: var(--sc-color-gray-500);\n      font-size: var(--sc-font-size-small);\n    }\n    .bump__new-price {\n      font-size: var(--sc-font-size-large);\n      color: var(--sc-color-gray-700);\n    }\n    .bump__interval {\n      color: var(--sc-color-gray-500);\n    }\n  }\n\n  &__amount {\n    display: flex;\n    align-items: center;\n    gap: var(--sc-spacing-x-small);\n    flex-wrap: wrap;\n    margin-top: var(--sc-spacing-xx-small);\n  }\n}\n","import { Component, Event, EventEmitter, h, Prop } from '@stencil/core';\nimport { sprintf, __ } from '@wordpress/i18n';\nimport { speak } from '@wordpress/a11y';\nimport { isBumpInOrder } from '../../../../functions/line-items';\nimport { getFormattedPrice, intervalString } from '../../../../functions/price';\nimport { getFeaturedProductMediaAttributes, sizeImage } from '../../../../functions/media';\nimport { state as checkoutState } from '@store/checkout';\n\nimport { Bump, LineItemData, Price, Product } from '../../../../types';\nimport { trackOrderBump } from '@store/checkout/mutations';\n\n@Component({\n  tag: 'sc-order-bump',\n  styleUrl: 'sc-order-bump.scss',\n  shadow: true,\n})\nexport class ScOrderBump {\n  /** The bump */\n  @Prop() bump: Bump;\n\n  /** Should we show the controls */\n  @Prop({ reflect: true }) showControl: boolean;\n\n  @Prop() cdnRoot: string = window.scData?.cdn_root;\n\n  /** Add line item event */\n  @Event() scAddLineItem: EventEmitter<LineItemData>;\n\n  /** Remove line item event */\n  @Event() scRemoveLineItem: EventEmitter<LineItemData>;\n\n  /** Update the line item. */\n  updateLineItem(add: boolean) {\n    const price_id = (this.bump.price as Price)?.id || (this.bump?.price as string);\n    if (add) {\n      this.scAddLineItem.emit({\n        bump: this.bump?.id,\n        price_id,\n        quantity: 1,\n      });\n      speak(__('Order bump applied.', 'surecart'));\n    } else {\n      this.scRemoveLineItem.emit({\n        price_id,\n        quantity: 1,\n      });\n      speak(__('Order bump Removed.', 'surecart'));\n    }\n  }\n\n  componentDidLoad() {\n    trackOrderBump(this.bump?.id);\n  }\n\n  newPrice() {\n    let amount = null;\n    let initialAmount = (this.bump?.price as Price)?.amount || 0;\n\n    if (this.bump?.amount_off) {\n      amount = Math.max(0, initialAmount - this.bump?.amount_off);\n    }\n    if (this.bump?.percent_off) {\n      const off = initialAmount * (this.bump?.percent_off / 100);\n      amount = Math.max(0, initialAmount - off);\n    }\n\n    return amount;\n  }\n\n  renderInterval() {\n    const interval = intervalString(this.bump?.price as Price, { labels: { interval: '/', period: __('for', 'surecart') } });\n    if (!interval.trim().length) return null;\n    return <span class=\"bump__interval\">{interval}</span>;\n  }\n\n  renderPrice() {\n    return (\n      <div slot=\"description\" class={{ 'bump__price': true, 'bump__price--has-discount': !!this.bump?.percent_off || !!this.bump?.amount_off }} part=\"price\">\n        <span\n          aria-label={\n            /** translators: %s: old price */\n            sprintf(\n              __('Originally priced at %s.', 'surecart'),\n              getFormattedPrice({\n                amount: (this.bump?.price as Price)?.amount,\n                currency: (this.bump?.price as Price)?.currency,\n              }),\n            )\n          }\n        >\n          <sc-format-number\n            type=\"currency\"\n            class=\"bump__original-price\"\n            value={(this.bump?.price as Price)?.amount}\n            currency={(this.bump?.price as Price)?.currency}\n          ></sc-format-number>{' '}\n        </span>\n        <span>\n          <span aria-hidden=\"true\">\n            {this.newPrice() === 0 && __('Free', 'surecart')}\n            {this.newPrice() !== null && this.newPrice() > 0 && (\n              <sc-format-number type=\"currency\" class=\"bump__new-price\" value={this.newPrice()} currency={(this.bump?.price as Price).currency} />\n            )}\n            {this.renderInterval()}\n          </span>\n        </span>\n      </div>\n    );\n  }\n\n  renderDiscount() {\n    if (!!this.bump?.amount_off) {\n      return (\n        <div\n          class=\"bump__tag\"\n          aria-label={\n            /** translators: %1$s: amount off, %2$s: currency */\n            sprintf(__('You save %1$s%2$s.', 'surecart'), this.bump?.amount_off, (this.bump?.price as Price).currency)\n          }\n        >\n          <span aria-hidden=\"true\">\n            {__('Save', 'surecart')} <sc-format-number type=\"currency\" value={-this.bump?.amount_off} currency={(this.bump?.price as Price).currency}></sc-format-number>\n          </span>\n        </div>\n      );\n    }\n\n    if (!!this.bump?.percent_off) {\n      return (\n        <div\n          class=\"bump__tag\"\n          aria-label={\n            /** translators: %s: amount percent off */\n            sprintf(__('You save %s%%.', 'surecart'), this.bump?.percent_off)\n          }\n        >\n          <span aria-hidden=\"true\">{sprintf(__('Save %s%%', 'surecart'), this.bump?.percent_off)}</span>\n        </div>\n      );\n    }\n  }\n\n  render() {\n    const product = (this.bump?.price as Price)?.product as Product;\n    const media = getFeaturedProductMediaAttributes(product);\n\n    return (\n      <sc-choice\n        value={this.bump?.id}\n        type=\"checkbox\"\n        showControl={this.showControl}\n        checked={isBumpInOrder(this.bump, checkoutState?.checkout)}\n        onScChange={e => this.updateLineItem(e.target.checked)}\n        onKeyDown={e => {\n          if (e.key === 'Enter' || e.key === ' ') {\n            e.preventDefault();\n            e.stopImmediatePropagation();\n            this.updateLineItem(!isBumpInOrder(this.bump, checkoutState?.checkout));\n          }\n        }}\n        exportparts=\"base, control, checked-icon, title\"\n      >\n        <div part=\"base-content\" class=\"bump\">\n          <div class=\"bump__text\">\n            <div\n              class=\"bump__title\"\n              aria-label={sprintf(\n                /* translators: %s: order bump name */\n                __('Product: %s.', 'surecart'),\n                this.bump?.metadata?.cta || this.bump?.name || product?.name,\n              )}\n            >\n              <span aria-hidden=\"true\">{this.bump?.metadata?.cta || this.bump?.name || product?.name}</span>\n            </div>\n            <div class=\"bump__amount\">\n              <span>{this.renderPrice()}</span>\n              <span>{this.renderDiscount()}</span>\n            </div>\n          </div>\n        </div>\n\n        {this.bump?.metadata?.description && (\n          <div slot=\"footer\" class=\"bump__product--wrapper\">\n            <sc-divider style={{ '--spacing': 'var(--sc-spacing-medium)' }}></sc-divider>\n            <div class=\"bump__product\">\n              {!!media?.url && <img src={sizeImage(media?.url, 130)} alt={media.alt} {...(media.title ? { title: media.title } : {})} class=\"bump__image\" />}\n              <div class=\"bump__product-text\">\n                {!!this.bump?.metadata?.cta && (\n                  <div class=\"bump__product-title\" aria-hidden=\"true\">\n                    {this.bump.name || product?.name}\n                  </div>\n                )}\n\n                {!!this.bump?.metadata?.description && (\n                  <div\n                    class=\"bump__product-description\"\n                    aria-label={sprintf(\n                      /* translators: %s: Product description */\n                      __('Product description: %s.', 'surecart'),\n                      this.bump?.metadata?.description,\n                    )}\n                  >\n                    <span aria-hidden=\"true\">{this.bump?.metadata?.description}</span>\n                  </div>\n                )}\n              </div>\n            </div>\n          </div>\n        )}\n      </sc-choice>\n    );\n  }\n}\n"],"version":3}