{"file":"sc-checkout-mollie-payment2.js","mappings":";;;;;;;;;;;;;;;;;;;;AAEO,MAAM,QAAQ,GAAG,CAAC,IAAI,EAAE,OAA0B,EAAE,QAAQ,KACjE,EAAE,CAAC,KAAK,EAAE,CAAC,GAAG,EAAE,QAAQ,EAAE,QAAQ;;EAEhC,IAAI,GAAG,KAAK,IAAI;IAAE,OAAO;;EAGzB,IAAI,KAAK,CAAC,OAAO,CAAC,OAAO,CAAC,EAAE;IAC1B,IAAI,OAAO,CAAC,IAAI,CAAC,GAAG,IAAI,IAAI,CAAC,SAAS,CAAC,QAAQ,aAAR,QAAQ,uBAAR,QAAQ,CAAG,GAAG,CAAC,CAAC,KAAK,IAAI,CAAC,SAAS,CAAC,QAAQ,aAAR,QAAQ,uBAAR,QAAQ,CAAG,GAAG,CAAC,CAAC,CAAC,EAAE;MAC5F,OAAO,QAAQ,CAAC,QAAQ,EAAE,QAAQ,CAAC,CAAC;KACrC;GACF;;EAGD,IAAI,OAAO,OAAO,KAAK,QAAQ,EAAE;IAC/B,IAAI,IAAI,CAAC,SAAS,CAAC,QAAQ,aAAR,QAAQ,uBAAR,QAAQ,CAAG,OAAO,CAAC,CAAC,KAAK,IAAI,CAAC,SAAS,CAAC,QAAQ,aAAR,QAAQ,uBAAR,QAAQ,CAAG,OAAO,CAAC,CAAC;MAAE,OAAO;IACxF,OAAO,QAAQ,CAAC,QAAQ,aAAR,QAAQ,uBAAR,QAAQ,CAAG,OAAO,CAAC,EAAE,QAAQ,aAAR,QAAQ,uBAAR,QAAQ,CAAG,OAAO,CAAC,CAAC,CAAC;GAC3D;AACH,CAAC,CAAC;;;;;sCCTa,eAAO;;MAEZ,UAAE;;;;;;;;;;sBCAC,UAAE;;wCAImB,UAAE;;QAE3B,UAAE;AAKb;;ACvBA,MAAM,0BAA0B,GAAG,sBAAsB;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;6DCsF9C,UAAE;;;6rBAkB+B,eAAO,CAAC,UAAE,gTAEnC,UAAE;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","names":[],"sources":["./src/store/checkout/functions.ts","./src/components/controllers/checkout-form/payment/ManualPaymentMethods.tsx","./src/components/controllers/checkout-form/payment/MockProcessor.tsx","./src/components/controllers/checkout-form/sc-checkout-mollie-payment/sc-checkout-mollie-payment.css?tag=sc-checkout-mollie-payment&encapsulation=shadow","./src/components/controllers/checkout-form/sc-checkout-mollie-payment/sc-checkout-mollie-payment.tsx"],"sourcesContent":["import { on } from './store';\n\nexport const listenTo = (prop, propKey: string | string[], callback) =>\n  on('set', (key, newValue, oldValue) => {\n    // ignore non-keys\n    if (key !== prop) return;\n\n    // handle an array, if one has changed, run callback.\n    if (Array.isArray(propKey)) {\n      if (propKey.some(key => JSON.stringify(newValue?.[key]) !== JSON.stringify(oldValue?.[key]))) {\n        return callback(newValue, oldValue);\n      }\n    }\n\n    // handle string.\n    if (typeof propKey === 'string') {\n      if (JSON.stringify(newValue?.[propKey]) === JSON.stringify(oldValue?.[propKey])) return;\n      return callback(newValue?.[propKey], oldValue?.[propKey]);\n    }\n  });\n","import { FunctionalComponent, h } from '@stencil/core';\nimport { sprintf, __ } from '@wordpress/i18n';\nimport { ManualPaymentMethod } from '../../../../types';\n\nexport const ManualPaymentMethods: FunctionalComponent<{ methods: ManualPaymentMethod[] }> = ({ methods }) =>\n  (methods || []).map(method => (\n    <sc-payment-method-choice is-manual processor-id={method?.id}>\n      <span slot=\"summary\">{method?.name}</span>\n      <sc-card>\n        <sc-payment-selected\n          label={sprintf(\n            // translators: Manual payment method.\n            __('%s selected for check out.', 'surecart'),\n            method?.name,\n          )}\n        >\n          <div innerHTML={method?.description}></div>\n        </sc-payment-selected>\n      </sc-card>\n    </sc-payment-method-choice>\n  ));\n","import { FunctionalComponent, h } from '@stencil/core';\nimport { __ } from '@wordpress/i18n';\nimport { Processor } from '../../../../types';\n\nexport const MockProcessor: FunctionalComponent<{ processor: Processor }> = ({ processor }) => {\n  if (!processor?.id) {\n    return null;\n  }\n  return (\n    <sc-payment-method-choice key={processor?.id} processor-id=\"mock\">\n      <span slot=\"summary\" class=\"sc-payment-toggle-summary\">\n        <sc-icon name=\"credit-card\" style={{ fontSize: '24px' }} aria-hidden=\"true\"></sc-icon>\n        <span>{__('Test Processor', 'surecart')}</span>\n      </span>\n\n      <sc-card>\n        <sc-payment-selected label={__('Test processor selected for check out.', 'surecart')}>\n          <sc-icon slot=\"icon\" name=\"credit-card\" aria-hidden=\"true\"></sc-icon>\n          {__('This is a test payment processor used to simulate test transactions. It is only available in test mode.', 'surecart')}\n        </sc-payment-selected>\n      </sc-card>\n    </sc-payment-method-choice>\n  );\n};\n",":host {\n  display: block;\n}\n","import { Component, Fragment, h, Prop, State } from '@stencil/core';\nimport { Address, Pagination, PaymentMethodType, ResponseError } from '../../../../types';\nimport { sprintf, __ } from '@wordpress/i18n';\nimport { addQueryArgs } from '@wordpress/url';\nimport { state as selectedProcessor } from '@store/selected-processor';\nimport { state as processorsState } from '@store/processors';\nimport { hasMultipleMethodChoices, availableMethodTypes, availableManualPaymentMethods, getAvailableProcessor } from '@store/processors/getters';\n// checkout store.\nimport { state as checkoutState } from '@store/checkout';\nimport { listenTo } from '@store/checkout/functions';\nimport { checkoutIsLocked } from '@store/checkout/getters';\nimport { lockCheckout, unLockCheckout } from '@store/checkout/mutations';\n\nimport apiFetch from '../../../../functions/fetch';\n\nimport { ManualPaymentMethods } from '../payment/ManualPaymentMethods';\nimport { createErrorNotice } from '@store/notices/mutations';\nimport { MockProcessor } from '../payment/MockProcessor';\n\n@Component({\n  tag: 'sc-checkout-mollie-payment',\n  styleUrl: 'sc-checkout-mollie-payment.css',\n  shadow: true,\n})\nexport class ScCheckoutMolliePayment {\n  @Prop() processorId: string;\n  @Prop() method: string;\n\n  @State() error: ResponseError;\n  @State() methods: PaymentMethodType[];\n\n  componentWillLoad() {\n    selectedProcessor.id = 'mollie';\n    this.fetchMethods();\n    listenTo('checkout', ['total_amount', 'currency', 'reusabled_payment_method_required', 'shipping_address'], () => this.fetchMethods());\n  }\n\n  async fetchMethods() {\n    const checkout = checkoutState.checkout;\n    if (!checkout?.currency || !checkout?.total_amount) return; // wait until we have a currency.\n    try {\n      lockCheckout('methods');\n      const response = (await apiFetch({\n        path: addQueryArgs(`surecart/v1/processors/${this.processorId}/payment_method_types`, {\n          amount: checkout?.total_amount,\n          country: (checkout?.shipping_address as Address)?.country || 'us',\n          currency: checkout?.currency,\n          ...(checkout?.reusable_payment_method_required ? { reusable: checkout?.reusable_payment_method_required } : {}),\n          per_page: 100,\n        }),\n      })) as {\n        object: 'list';\n        pagination: Pagination;\n        data: PaymentMethodType[];\n      };\n      processorsState.methods = response?.data || [];\n    } catch (e) {\n      createErrorNotice(e);\n      console.error(e);\n    } finally {\n      unLockCheckout('methods');\n    }\n  }\n\n  renderLoading() {\n    return (\n      <sc-card>\n        <sc-skeleton style={{ width: '50%', marginBottom: '0.5em' }}></sc-skeleton>\n        <sc-skeleton style={{ width: '30%', marginBottom: '0.5em' }}></sc-skeleton>\n        <sc-skeleton style={{ width: '60%', marginBottom: '0.5em' }}></sc-skeleton>\n      </sc-card>\n    );\n  }\n\n  render() {\n    if (checkoutIsLocked('methods') && !availableMethodTypes()?.length) {\n      return this.renderLoading();\n    }\n\n    if (!checkoutState.checkout?.currency) {\n      return this.renderLoading();\n    }\n\n    if (!availableMethodTypes()?.length) {\n      return (\n        <sc-alert type=\"warning\" open>\n          {__('No available payment methods', 'surecart')}{' '}\n        </sc-alert>\n      );\n    }\n\n    const Tag = hasMultipleMethodChoices() ? 'sc-toggles' : 'div';\n\n    return (\n      <Fragment>\n        <Tag collapsible={false} theme=\"container\">\n          {(availableMethodTypes() || []).map(method => (\n            <sc-payment-method-choice processor-id=\"mollie\" method-id={method?.id} key={method?.id}>\n              <span slot=\"summary\" class=\"sc-payment-toggle-summary\">\n                {!!method?.image && <img src={method?.image} aria-hidden=\"true\" />}\n                <span>{method?.description}</span>\n              </span>\n\n              <sc-card>\n                <sc-payment-selected label={sprintf(__('%s selected for check out.', 'surecart'), method?.description)}>\n                  {!!method?.image && <img slot=\"icon\" src={method?.image} style={{ width: '32px' }} />}\n                  {__('Another step will appear after submitting your order to complete your purchase details.', 'surecart')}\n                </sc-payment-selected>\n              </sc-card>\n            </sc-payment-method-choice>\n          ))}\n          <MockProcessor processor={getAvailableProcessor('mock')} />\n          <ManualPaymentMethods methods={availableManualPaymentMethods()} />\n        </Tag>\n        {!!checkoutIsLocked('methods') && <sc-block-ui class=\"busy-block-ui\" z-index={9} style={{ '--sc-block-ui-opacity': '0.4' }}></sc-block-ui>}\n      </Fragment>\n    );\n  }\n}\n"],"version":3}