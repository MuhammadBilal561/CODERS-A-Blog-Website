{"file":"sc-cancel-discount2.js","mappings":";;;;;;;;;;;;AAIA;;;;;AAKA;AAEA;;;;AAMA;;;;;;;qCAQqC,UAAE;2CAE/B,UAAE;cAGI,UAAE;mBACG,UAAE;;;;;;;;;;;AAYrB;;AC3CA,MAAM,mBAAmB,GAAG,8DAA8D;;MCa7E,gBAAgB;;;;;;;;;;;;;;EAU3B,MAAM,WAAW;;IACf,IAAI;MACF,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC;MACpB,IAAI,CAAC,YAAY,IAAI,MAAM,QAAQ,CAAC;QAClC,MAAM,EAAE,OAAO;QACf,IAAI,EAAE,YAAY,CAAC,6BAA6B,MAAA,IAAI,CAAC,YAAY,0CAAE,EAAE,WAAW,EAAE;UAChF,gBAAgB,EAAE;YAChB,IAAI,CAAC,CAAC,IAAI,CAAC,OAAO,GAAG,EAAE,OAAO,EAAE,IAAI,CAAC,OAAO,EAAE,GAAG,EAAE,CAAC;YACpD,sBAAsB,EAAE,MAAA,IAAI,CAAC,MAAM,0CAAE,EAAE;WACxC;SACF,CAAC;OACH,CAAC,CAAiB,CAAC;MACpB,IAAI,CAAC,WAAW,CAAC,IAAI,EAAE,CAAC;KACzB;IAAC,OAAO,CAAC,EAAE;MACV,OAAO,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC;MACjB,IAAI,CAAC,KAAK,GAAG,CAAC,CAAC;KAChB;YAAS;MACR,IAAI,CAAC,OAAO,GAAG,KAAK,CAAC;KACtB;GACF;EAED,WAAW;;IACT,OAAO,CAAC,EAAC,MAAA,MAAA,IAAI,CAAC,YAAY,0CAAE,QAAQ,0CAAE,EAAE,CAAA,CAAC;GAC1C;EAED,MAAM;;IACJ,MAAM,EAAE,KAAK,EAAE,WAAW,EAAE,MAAM,EAAE,WAAW,EAAE,GAAG,0BAA0B,CAAC,IAAI,CAAC,QAAQ,EAAE,MAAA,MAAA,IAAI,CAAC,YAAY,0CAAE,QAAQ,0CAAE,EAAE,CAAC,CAAC;IAC/H,QACE,WAAK,KAAK,EAAC,iBAAiB,IAC1B,2BAAqB,OAAO,EAAE,KAAK,EAAE,KAAK,EAAE,EAAE,+BAA+B,EAAE,KAAK,EAAE,IACpF,YAAM,IAAI,EAAC,aAAa,IAAE,WAAW,CAAQ,EAC7C,eAAS,cAAc,EAAC,YAAY,IAClC,iBAAW,IAAI,EAAC,SAAS,EAAC,OAAO,EAAE,MAAM,IAAI,CAAC,WAAW,EAAE,IACxD,MAAM,CACG,EACZ,iBAAW,KAAK,EAAC,6BAA6B,EAAC,IAAI,EAAC,MAAM,EAAC,OAAO,EAAE,MAAM,IAAI,CAAC,QAAQ,CAAC,IAAI,EAAE,IAC3F,WAAW,CACF,CACJ,EACT,CAAC,CAAC,IAAI,CAAC,OAAO,IAAI,mBAAa,OAAO,SAAG,CACtB,CAClB,EACN;GACH;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","names":[],"sources":["./src/components/controllers/dashboard/sc-cancel-discount/functions.ts","./src/components/controllers/dashboard/sc-cancel-discount/sc-cancel-discount.scss?tag=sc-cancel-discount&encapsulation=shadow","./src/components/controllers/dashboard/sc-cancel-discount/sc-cancel-discount.tsx"],"sourcesContent":["import { getHumanDiscount } from '../../../../functions/price';\nimport { Coupon, SubscriptionProtocol } from '../../../../types';\nimport { __ } from '@wordpress/i18n';\n\n/**\n * Replace the {{ name }} in a string with a new value\n */\nexport const replaceAmount = (string, replace, name = 'amount') => {\n  return string.replaceAll('{{' + name + '}}', replace).replaceAll('{{ ' + name + ' }}', replace);\n};\n\n/**\n * Replace the amount in a string with discount.\n */\nexport const replaceAmountFromString = (amountStr, protocol) =>\n  protocol?.preservation_coupon ? replaceAmount(amountStr, getHumanDiscount(protocol?.preservation_coupon as Coupon)) : amountStr;\n\n/**\n *\n */\nexport const getCurrentBehaviourContent = (protocol: SubscriptionProtocol, hasDiscount) => {\n  const { preserve_title, preserve_description, preserve_button, cancel_link } = protocol?.preservation_locales || {};\n\n  if (hasDiscount) {\n    const discountLocales = {\n      title: replaceAmountFromString(__('Your {{ amount }} discount is still active.', 'surecart'), protocol),\n      description: replaceAmountFromString(\n        __('You have a {{ amount }} discount active. Cancelling now will forfeit this discount forever. Are you sure you wish to cancel?', 'surecart'),\n        protocol,\n      ),\n      button: __('Keep My Discount', 'surecart'),\n      cancel_link: __('Cancel Anyway', 'surecart'),\n    };\n    return discountLocales;\n  }\n\n  const defaultLocales = {\n    title: replaceAmountFromString(preserve_title, protocol),\n    description: replaceAmountFromString(preserve_description, protocol),\n    button: preserve_button,\n    cancel_link: cancel_link,\n  };\n  return defaultLocales;\n};\n",".cancel-discount {\n  &__abort-link {\n    color: var(--sc-color-gray-500);\n  }\n}\n","import { Component, Event, EventEmitter, h, Prop, State } from '@stencil/core';\nimport { __ } from '@wordpress/i18n';\nimport { addQueryArgs } from '@wordpress/url';\n\nimport apiFetch from '../../../../functions/fetch';\nimport { CancellationReason, ResponseError, Subscription, SubscriptionProtocol } from '../../../../types';\nimport { getCurrentBehaviourContent } from './functions';\n\n@Component({\n  tag: 'sc-cancel-discount',\n  styleUrl: 'sc-cancel-discount.scss',\n  shadow: true,\n})\nexport class ScCancelDiscount {\n  @Prop() subscription: Subscription;\n  @Prop() reason: CancellationReason;\n  @Prop() comment: string;\n  @Prop() protocol: SubscriptionProtocol;\n  @Event() scCancel: EventEmitter<void>;\n  @Event() scPreserved: EventEmitter<void>;\n  @State() loading: boolean;\n  @State() error: ResponseError;\n\n  async addDiscount() {\n    try {\n      this.loading = true;\n      this.subscription = (await apiFetch({\n        method: 'PATCH',\n        path: addQueryArgs(`surecart/v1/subscriptions/${this.subscription?.id}/preserve`, {\n          cancellation_act: {\n            ...(!!this.comment ? { comment: this.comment } : {}),\n            cancellation_reason_id: this.reason?.id,\n          },\n        }),\n      })) as Subscription;\n      this.scPreserved.emit();\n    } catch (e) {\n      console.error(e);\n      this.error = e;\n    } finally {\n      this.loading = false;\n    }\n  }\n\n  hasDiscount() {\n    return !!this.subscription?.discount?.id;\n  }\n\n  render() {\n    const { title, description, button, cancel_link } = getCurrentBehaviourContent(this.protocol, this.subscription?.discount?.id);\n    return (\n      <div class=\"cancel-discount\">\n        <sc-dashboard-module heading={title} style={{ '--sc-dashboard-module-spacing': '2em' }}>\n          <span slot=\"description\">{description}</span>\n          <sc-flex justifyContent=\"flex-start\">\n            <sc-button type=\"primary\" onClick={() => this.addDiscount()}>\n              {button}\n            </sc-button>\n            <sc-button class=\"cancel-discount__abort-link\" type=\"text\" onClick={() => this.scCancel.emit()}>\n              {cancel_link}\n            </sc-button>\n          </sc-flex>\n          {!!this.loading && <sc-block-ui spinner />}\n        </sc-dashboard-module>\n      </div>\n    );\n  }\n}\n"],"version":3}