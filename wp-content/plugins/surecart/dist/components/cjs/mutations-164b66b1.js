"use strict";const index=require("./index-00f0fc21.js"),utils=require("./utils-a086ed6e.js"),getQueryArg=require("./get-query-arg-53bf21e2.js"),index$1=require("./index-fb76df07.js"),google=require("./google-62bdaeea.js"),currency=require("./currency-ba038e2f.js"),addQueryArgs=require("./add-query-args-17c551b6.js"),price=require("./price-f1f1114d.js");function removeQueryArgs(n){const e=n.indexOf("?");if(-1===e)return n;const o=addQueryArgs.getQueryArgs(n),t=n.substr(0,e);for(var i=arguments.length,d=new Array(i>1?i-1:0),u=1;u<i;u++)d[u-1]=arguments[u];d.forEach((n=>delete o[n]));const r=addQueryArgs.buildQueryString(o);return r?t+"?"+r:t}const safeRead=(n,e)=>{try{return JSON.parse(n.getItem(e))}catch{return null}},debounce=n=>{let e=!1;return()=>{e||(e=!0,setTimeout((()=>{n(),e=!1}),0))}},createStorageStore=(n,e,o,t=!1)=>{var i;const d=index.createStore(null!==(i=safeRead(n,e))&&void 0!==i?i:o,((n,e)=>JSON.stringify(n)!==JSON.stringify(e))),u=debounce((()=>n.setItem(e,JSON.stringify(d.state))));return u(),t&&window.addEventListener("storage",(()=>{const o=safeRead(n,e);if(null!==o)for(const n in o)d.set(n,o[n])})),d.use({set:u,reset:u}),d},createLocalStore=(n,e,o=!1)=>createStorageStore(localStorage,n,e,o),{checkout:checkout$1}=utils.getSerializedState(),notPersistCart="browser"!==(null==checkout$1?void 0:checkout$1.persist)||!!getQueryArg.getQueryArg(window.location.href,"no_cart"),store$1=notPersistCart?index.createStore({live:{},test:{}}):createLocalStore("surecart-local-storage",{live:{},test:{}},!0),{state:state$2,onChange:onChange$1,on:on$2,set:set$1,get:get$1,dispose:dispose$1}=store$1;window.scStore=store$1;const{checkout:checkout}=utils.getSerializedState(),{state:state$1,onChange:onChange,on:on$1,set:set,get:get,dispose:dispose,reset:reset}=index.createStore({formId:null,groupId:null,mode:"live",locks:[],product:null,checkout:null,currencyCode:"usd",abandonedCheckoutEnabled:!0,initialLineItems:[],isCheckoutPage:!1,validateStock:!1,persist:"browser",paymentMethodRequiresShipping:!1,...checkout},((n,e)=>JSON.stringify(n)!==JSON.stringify(e)));onChange("checkout",(n=>setCheckout(n,state$1.formId))),on$1("get",(n=>{if("checkout"===n){const n=getCheckout(state$1.formId,state$1.mode);(null==n?void 0:n.id)&&(state$1.checkout=n)}})),on$1("set",((n,e,o)=>{var t,i,d,u,r,l,c,v,a,s,m,p,y,_,h;if("checkout"!==n)return;if(!o||!e)return;if((null==e?void 0:e.total_amount)===(null==o?void 0:o.total_amount)&&(null==e?void 0:e.amount_due)===(null==o?void 0:o.total_amount))return;const g=price.getFormattedPrice({amount:e.amount_due,currency:e.currency}),w=price.getFormattedPrice({amount:e.total_amount,currency:e.currency}),f=(null===(i=null===(t=null==e?void 0:e.discount)||void 0===t?void 0:t.promotion)||void 0===i?void 0:i.code)!==(null===(u=null===(d=null==o?void 0:o.discount)||void 0===d?void 0:d.promotion)||void 0===u?void 0:u.code)&&(null===(l=null===(r=null==e?void 0:e.discount)||void 0===r?void 0:r.promotion)||void 0===l?void 0:l.code),C=[...(null===(v=null===(c=null==e?void 0:e.discount)||void 0===c?void 0:c.promotion)||void 0===v?void 0:v.code)===(null===(s=null===(a=null==o?void 0:o.discount)||void 0===a?void 0:a.promotion)||void 0===s?void 0:s.code)||(null===(p=null===(m=null==e?void 0:e.discount)||void 0===m?void 0:m.promotion)||void 0===p?void 0:p.code)?[]:[wp.i18n.__("Coupon code removed.","sc-coupon-form")],...f?[wp.i18n.sprintf(
// Translators: %1$s is the coupon code, %2$s is the human readable discount.
wp.i18n.__("Coupon code %1$s added. %2$s applied.","sc-coupon-form"),null===(_=null===(y=null==e?void 0:e.discount)||void 0===y?void 0:y.promotion)||void 0===_?void 0:_.code,price.getHumanDiscount(null===(h=null==e?void 0:e.discount)||void 0===h?void 0:h.coupon))]:[],e.total_amount===e.amount_due?wp.i18n.sprintf(wp.i18n.__("Checkout updated. The amount due is %1$s.","surecart"),g):wp.i18n.sprintf(wp.i18n.__("Checkout updated. The total amount for the checkout is %1$s and the amount due is %1$s.","surecart"),w,g)];index$1.speak(C.join(" "))}));const store=index.createStore((()=>({cart:{open:!1}})),((n,e)=>JSON.stringify(n)!==JSON.stringify(e))),{state:state}=store,toggleCart=(n=null)=>store.set("cart",{...state.cart,open:null!==n?n:!state.cart.open}),{on:on}=store;on("set",((n,e)=>{"cart"===n&&((null==e?void 0:e.open)?index$1.speak(wp.i18n.__("Cart Opened","surecart"),"assertive"):index$1.speak(wp.i18n.__("Cart Closed","surecart"),"assertive"))})),on$2("set",((n,e,o)=>Object.keys(e||{}).forEach((n=>handleCheckoutLineItemChange(e[n],null==o?void 0:o[n])))));const handleCheckoutLineItemChange=(n,e)=>{var o,t;const i=(null===(o=null==n?void 0:n.line_items)||void 0===o?void 0:o.data)||[],d=(null===(t=null==e?void 0:e.line_items)||void 0===t?void 0:t.data)||[];if(i.forEach((n=>{const e=d.find((e=>e.id===n.id));if(!e||(null==e?void 0:e.quantity)<(null==n?void 0:n.quantity)){const o=new CustomEvent("scAddedToCart",{detail:{...n,quantity:n.quantity-((null==e?void 0:e.quantity)||0)},bubbles:!0});document.dispatchEvent(o)}})),d.forEach((n=>{const e=i.find((e=>e.id===n.id));if(!e||(null==n?void 0:n.quantity)>(null==e?void 0:e.quantity)){const o=new CustomEvent("scRemovedFromCart",{detail:{...n,quantity:n.quantity-((null==e?void 0:e.quantity)||0)},bubbles:!0});document.dispatchEvent(o)}})),!(null==state$1?void 0:state$1.isCheckoutPage)&&JSON.stringify(i)!==JSON.stringify(d)){const o=new CustomEvent("scCartUpdated",{detail:{currentCart:n,previousCart:e},bubbles:!0});document.dispatchEvent(o)}};on("set",((n,e,o)=>{if("cart"===n&&(null==e?void 0:e.open)!==(null==o?void 0:o.open)&&(null==e?void 0:e.open)){const n=new CustomEvent("scViewedCart",{detail:state$1.checkout,bubbles:!0});document.dispatchEvent(n)}})),on$1("set",((n,e,o)=>{if("checkout"!==n)return;if(null==o?void 0:o.id)return;if(!(null==e?void 0:e.id))return;if(!state$1.isCheckoutPage)return;const t=new CustomEvent("scCheckoutInitiated",{detail:e,bubbles:!0});document.dispatchEvent(t)})),on$1("set",((n,e,o)=>{var t,i;if("checkout"!==n)return;if(!(null==e?void 0:e.status)||(null==o?void 0:o.status)===(null==e?void 0:e.status))return;if(!["paid","processing"].includes(e.status))return;const d=new CustomEvent("scOrderPaid",{detail:e,bubbles:!0});document.dispatchEvent(d);const u=new CustomEvent("scCheckoutCompleted",{detail:e,bubbles:!0});document.dispatchEvent(u);const r=((null===(t=null==e?void 0:e.line_items)||void 0===t?void 0:t.data)||[]).filter((n=>{var e;return(null===(e=null==n?void 0:n.price)||void 0===e?void 0:e.trial_duration_days)>0}));if(r.length>0){const n=new CustomEvent("scTrialStarted",{detail:r,bubbles:!0});document.dispatchEvent(n)}const l=((null===(i=null==e?void 0:e.line_items)||void 0===i?void 0:i.data)||[]).filter((n=>{var e;return(null===(e=null==n?void 0:n.price)||void 0===e?void 0:e.recurring_interval_count)>0}));if(l.length>0){const n=new CustomEvent("scSubscriptionStarted",{detail:l,bubbles:!0});document.dispatchEvent(n)}})),on$1("set",((n,e,o)=>{if("checkout"!==n)return;if(!state$1.isCheckoutPage)return;if(!(null==e?void 0:e.selected_shipping_choice))return;if((null==o?void 0:o.selected_shipping_choice)===(null==e?void 0:e.selected_shipping_choice))return;const t=new CustomEvent("scShippingInfoAdded",{detail:e,bubbles:!0});document.dispatchEvent(t)})),on$1("set",((n,e,o)=>{if("checkout"!==n)return;if(!state$1.isCheckoutPage)return;if(!(null==o?void 0:o.id))return;if(JSON.stringify(e)===JSON.stringify(o))return;const t=new CustomEvent("scCheckoutUpdated",{detail:{currentCheckout:e,previousCheckout:o},bubbles:!0});document.dispatchEvent(t)})),window.addEventListener("scAddedToCart",(n=>{var e,o,t,i,d,u,r,l,c,v,a,s;const m=n.detail;(null===(e=null==m?void 0:m.price)||void 0===e?void 0:e.product)&&google.trackEvent("add_to_cart",{currency:null===(o=m.price)||void 0===o?void 0:o.currency,value:currency.maybeConvertAmount((null===(t=null==m?void 0:m.price)||void 0===t?void 0:t.amount)||0,(null===(i=m.price)||void 0===i?void 0:i.currency)||"USD"),items:[{item_id:null===(u=null===(d=m.price)||void 0===d?void 0:d.product)||void 0===u?void 0:u.id,item_name:null===(l=null===(r=m.price)||void 0===r?void 0:r.product)||void 0===l?void 0:l.name,item_variant:(m.variant_options||[]).join(" / "),price:currency.maybeConvertAmount((null===(c=null==m?void 0:m.price)||void 0===c?void 0:c.amount)||0,(null===(v=m.price)||void 0===v?void 0:v.currency)||"USD"),currency:null===(a=m.price)||void 0===a?void 0:a.currency,quantity:m.quantity,discount:(null==m?void 0:m.discount_amount)?currency.maybeConvertAmount((null==m?void 0:m.discount_amount)||0,(null===(s=m.price)||void 0===s?void 0:s.currency)||"USD"):0}]})})),window.addEventListener("scRemovedFromCart",(n=>{var e,o,t,i,d,u,r,l,c,v,a,s;const m=n.detail;(null===(e=null==m?void 0:m.price)||void 0===e?void 0:e.product)&&google.trackEvent("remove_from_cart",{currency:null===(o=m.price)||void 0===o?void 0:o.currency,value:currency.maybeConvertAmount((null===(t=null==m?void 0:m.price)||void 0===t?void 0:t.amount)||0,(null===(i=m.price)||void 0===i?void 0:i.currency)||"USD"),items:[{item_id:null===(u=null===(d=m.price)||void 0===d?void 0:d.product)||void 0===u?void 0:u.id,item_name:null===(l=null===(r=m.price)||void 0===r?void 0:r.product)||void 0===l?void 0:l.name,item_variant:(m.variant_options||[]).join(" / "),price:currency.maybeConvertAmount((null===(c=null==m?void 0:m.price)||void 0===c?void 0:c.amount)||0,(null===(v=m.price)||void 0===v?void 0:v.currency)||"USD"),currency:null===(a=m.price)||void 0===a?void 0:a.currency,quantity:m.quantity,discount:(null==m?void 0:m.discount_amount)?currency.maybeConvertAmount((null==m?void 0:m.discount_amount)||0,(null===(s=m.price)||void 0===s?void 0:s.currency)||"USD"):0}]})})),window.addEventListener("scViewedCart",(n=>{var e;const o=n.detail;google.trackEvent("view_cart",{currency:o.currency,value:currency.maybeConvertAmount(o.total_amount,o.currency),items:((null===(e=o.line_items)||void 0===e?void 0:e.data)||[]).map((n=>{var e,o,t,i,d,u,r,l,c;return{item_id:null===(o=null===(e=null==n?void 0:n.price)||void 0===e?void 0:e.product)||void 0===o?void 0:o.id,item_name:null===(i=null===(t=null==n?void 0:n.price)||void 0===t?void 0:t.product)||void 0===i?void 0:i.name,currency:null===(d=n.price)||void 0===d?void 0:d.currency,discount:n.discount_amount?currency.maybeConvertAmount(n.discount_amount,null===(u=n.price)||void 0===u?void 0:u.currency):0,price:currency.maybeConvertAmount(null===(r=null==n?void 0:n.price)||void 0===r?void 0:r.amount,null===(l=n.price)||void 0===l?void 0:l.currency),quantity:n.quantity,...(null===(c=null==n?void 0:n.variant_options)||void 0===c?void 0:c.length)?{item_variant:(n.variant_options||[]).join(" / ")}:{}}}))})})),window.addEventListener("scCheckoutInitiated",(n=>{var e;const o=n.detail;google.trackEvent("begin_checkout",{currency:o.currency,value:currency.maybeConvertAmount(o.total_amount,o.currency),items:((null===(e=o.line_items)||void 0===e?void 0:e.data)||[]).map((n=>{var e,o,t,i,d,u,r,l,c;return{item_id:null===(o=null===(e=null==n?void 0:n.price)||void 0===e?void 0:e.product)||void 0===o?void 0:o.id,item_name:null===(i=null===(t=null==n?void 0:n.price)||void 0===t?void 0:t.product)||void 0===i?void 0:i.name,currency:null===(d=n.price)||void 0===d?void 0:d.currency,discount:n.discount_amount?currency.maybeConvertAmount(n.discount_amount,null===(u=n.price)||void 0===u?void 0:u.currency):0,price:currency.maybeConvertAmount(null===(r=null==n?void 0:n.price)||void 0===r?void 0:r.amount,null===(l=n.price)||void 0===l?void 0:l.currency),quantity:n.quantity,...(null===(c=null==n?void 0:n.variant_options)||void 0===c?void 0:c.length)?{item_variant:(n.variant_options||[]).join(" / ")}:{}}}))})})),window.addEventListener("scCheckoutCompleted",(n=>{var e;const o=n.detail;google.trackEvent("purchase",{transaction_id:null==o?void 0:o.id,value:currency.maybeConvertAmount(null==o?void 0:o.total_amount,(null==o?void 0:o.currency)||"USD"),currency:(o.currency||"").toUpperCase(),items:((null===(e=null==o?void 0:o.line_items)||void 0===e?void 0:e.data)||[]).map((n=>{var e,t,i,d,u,r,l,c;return{item_id:null===(t=null===(e=null==n?void 0:n.price)||void 0===e?void 0:e.product)||void 0===t?void 0:t.id,currency:(o.currency||"").toUpperCase(),item_name:(null===(d=null===(i=null==n?void 0:n.price)||void 0===i?void 0:i.product)||void 0===d?void 0:d.name)||"",discount:(null==n?void 0:n.discount_amount)?currency.maybeConvertAmount((null==n?void 0:n.discount_amount)||0,(null===(u=null==n?void 0:n.price)||void 0===u?void 0:u.currency)||"USD"):0,price:currency.maybeConvertAmount((null===(r=null==n?void 0:n.price)||void 0===r?void 0:r.amount)||0,(null===(l=null==n?void 0:n.price)||void 0===l?void 0:l.currency)||"USD"),quantity:(null==n?void 0:n.quantity)||1,...(null===(c=null==n?void 0:n.variant_options)||void 0===c?void 0:c.length)?{item_variant:(n.variant_options||[]).join(" / ")}:{}}}))})})),window.addEventListener("scPaymentInfoAdded",(n=>{var e;const o=n.detail;google.trackEvent("add_payment_info",{currency:o.currency,value:currency.maybeConvertAmount(o.total_amount,o.currency),items:((null===(e=o.line_items)||void 0===e?void 0:e.data)||[]).map((n=>{var e,o,t,i,d,u,r,l,c;return{item_id:null===(o=null===(e=null==n?void 0:n.price)||void 0===e?void 0:e.product)||void 0===o?void 0:o.id,item_name:(null===(i=null===(t=null==n?void 0:n.price)||void 0===t?void 0:t.product)||void 0===i?void 0:i.name)||"",currency:null===(d=n.price)||void 0===d?void 0:d.currency,discount:n.discount_amount?currency.maybeConvertAmount(n.discount_amount,null===(u=n.price)||void 0===u?void 0:u.currency):0,price:currency.maybeConvertAmount(null===(r=null==n?void 0:n.price)||void 0===r?void 0:r.amount,null===(l=n.price)||void 0===l?void 0:l.currency),quantity:n.quantity,...(null===(c=null==n?void 0:n.variant_options)||void 0===c?void 0:c.length)?{item_variant:(n.variant_options||[]).join(" / ")}:{}}}))})})),window.addEventListener("scShippingInfoAdded",(n=>{var e,o,t,i,d,u,r,l;const c=n.detail,v=null===(o=null===(e=null==c?void 0:c.shipping_choices)||void 0===e?void 0:e.data)||void 0===o?void 0:o.find((n=>n.id===(null==c?void 0:c.selected_shipping_choice))),a=(null===(t=null==v?void 0:v.shipping_method)||void 0===t?void 0:t.name)||"";google.trackEvent("add_shipping_info",{currency:c.currency,value:currency.maybeConvertAmount(c.total_amount,c.currency),...(null===(d=null===(i=null==c?void 0:c.discount)||void 0===i?void 0:i.promotion)||void 0===d?void 0:d.code)?{coupon:null===(r=null===(u=null==c?void 0:c.discount)||void 0===u?void 0:u.promotion)||void 0===r?void 0:r.code}:{},...a?{shipping_tier:a}:"",items:((null===(l=c.line_items)||void 0===l?void 0:l.data)||[]).map((n=>{var e,o,t,i,d,u,r,l,c;return{item_id:null===(o=null===(e=null==n?void 0:n.price)||void 0===e?void 0:e.product)||void 0===o?void 0:o.id,item_name:(null===(i=null===(t=null==n?void 0:n.price)||void 0===t?void 0:t.product)||void 0===i?void 0:i.name)||"",currency:null===(d=n.price)||void 0===d?void 0:d.currency,discount:n.discount_amount?currency.maybeConvertAmount(n.discount_amount,null===(u=n.price)||void 0===u?void 0:u.currency):0,price:currency.maybeConvertAmount(null===(r=null==n?void 0:n.price)||void 0===r?void 0:r.amount,null===(l=n.price)||void 0===l?void 0:l.currency),quantity:n.quantity,...(null===(c=null==n?void 0:n.variant_options)||void 0===c?void 0:c.length)?{item_variant:(n.variant_options||[]).join(" / ")}:{}}}))})})),window.addEventListener("scAddedToCart",(function(n){var e,o,t,i,d,u,r,l;if(!(null===window||void 0===window?void 0:window.fbq))return;const c=n.detail;if(!(null===(e=null==c?void 0:c.price)||void 0===e?void 0:e.product))return;const v=null===(o=null==c?void 0:c.price)||void 0===o?void 0:o.product,a=(null===(i=null===(t=null==v?void 0:v.product_collections)||void 0===t?void 0:t.data)||void 0===i?void 0:i.map((n=>n.name)))||[];window.fbq("track","AddToCart",{...a.length?{content_category:a.join(", ")}:{},content_ids:[v.id],content_name:(null==v?void 0:v.name)+((null===(d=null==c?void 0:c.variant_options)||void 0===d?void 0:d.length)?` - ${null==c?void 0:c.variant_options.join(" / ")}`:""),content_type:"product",contents:[{id:v.id,quantity:c.quantity}],currency:null===(u=null==c?void 0:c.price)||void 0===u?void 0:u.currency,value:currency.maybeConvertAmount((null===(r=null==c?void 0:c.price)||void 0===r?void 0:r.amount)||0,(null===(l=null==c?void 0:c.price)||void 0===l?void 0:l.currency)||"USD")})})),window.addEventListener("scCheckoutInitiated",(function(n){var e,o,t,i;if(!(null===window||void 0===window?void 0:window.fbq))return;const d=n.detail;window.fbq("track","InitiateCheckout",{content_ids:null===(e=(null==d?void 0:d.line_items.data)||[])||void 0===e?void 0:e.map((n=>n.id)),contents:null===(o=(null==d?void 0:d.line_items.data)||[])||void 0===o?void 0:o.map((n=>({id:n.id,quantity:n.quantity}))),currency:null==d?void 0:d.currency,num_items:(null===(i=null===(t=null==d?void 0:d.line_items)||void 0===t?void 0:t.data)||void 0===i?void 0:i.length)||0,value:currency.maybeConvertAmount(null==d?void 0:d.total_amount,(null==d?void 0:d.currency)||"USD")})})),window.addEventListener("scCheckoutCompleted",(function(n){var e,o,t;if(!(null===window||void 0===window?void 0:window.fbq))return;const i=n.detail;window.fbq("track","Purchase",{content_ids:null===(e=null==i?void 0:i.items)||void 0===e?void 0:e.map((n=>n.item_id)),content_name:"Purchase",content_type:"product",contents:null===(o=null==i?void 0:i.items)||void 0===o?void 0:o.map((n=>({id:n.item_id,quantity:n.quantity}))),currency:null==i?void 0:i.currency,num_items:null===(t=null==i?void 0:i.items)||void 0===t?void 0:t.length,value:currency.maybeConvertAmount(null==i?void 0:i.total_amount,(null==i?void 0:i.currency)||"USD")})})),window.addEventListener("scTrialStarted",(function(n){(null===window||void 0===window?void 0:window.fbq)&&n.detail.forEach((n=>{var e,o,t;window.fbq("track","StartTrial",{currency:null===(e=n.price)||void 0===e?void 0:e.currency,value:currency.maybeConvertAmount((null===(o=n.price)||void 0===o?void 0:o.amount)||0,(null===(t=n.price)||void 0===t?void 0:t.currency)||"USD")})}))})),window.addEventListener("scSubscriptionStarted",(function(n){(null===window||void 0===window?void 0:window.fbq)&&n.detail.forEach((n=>{var e,o,t;window.fbq("track","Subscribe",{currency:null===(e=n.price)||void 0===e?void 0:e.currency,value:currency.maybeConvertAmount((null===(o=n.price)||void 0===o?void 0:o.amount)||0,(null===(t=n.price)||void 0===t?void 0:t.currency)||"USD")})}))})),window.addEventListener("scPaymentInfoAdded",(function(n){if(!(null===window||void 0===window?void 0:window.fbq))return;const e=n.detail;window.fbq("track","AddPaymentInfo",{content_category:"Payment Info Added",currency:null==e?void 0:e.currency})}));const getCheckout=(n,e)=>{var o;return(null===(o=store$1.state[e])||void 0===o?void 0:o[n])||{}},setCheckout=(n,e)=>{const o=(null==n?void 0:n.live_mode)?"live":"test";store$1.set(o,{...store$1.state[o],[e]:n}),state$1.formId===e&&state$1.mode===o&&(state$1.checkout=n),"url"===state$1.persist&&(null==n?void 0:n.id)&&window.history.replaceState({},document.title,addQueryArgs.addQueryArgs(window.location.href,{checkout_id:null==n?void 0:n.id}))},clearCheckout=(n,e)=>{const{[n]:o,...t}=store$1.state[e];window.history.replaceState({},document.title,removeQueryArgs(window.location.href,"redirect_status","coupon","line_items","confirm_checkout_id","checkout_id")),store$1.set(e,t),reset()};exports.clearCheckout=clearCheckout,exports.getCheckout=getCheckout,exports.on=on$1,exports.onChange=onChange,exports.onChange$1=onChange$1,exports.removeQueryArgs=removeQueryArgs,exports.setCheckout=setCheckout,exports.state=state$1,exports.store=store,exports.toggleCart=toggleCart;